<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ—¥è®°æœ¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== åŸºç¡€æ ·å¼ä¸CSSå˜é‡ (ç”¨äºä¸»é¢˜åˆ‡æ¢) ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; transition: background-color 0.5s ease, color 0.3s ease, border-color 0.3s ease; }
        :root {
            --color-primary: #ffb6d9; --color-primary-dark: #ff8ec7; --color-primary-light: #ffeff6;
            --color-secondary: #fff9b6; --color-secondary-dark: #ffeaa5;
            --color-accent: #d9cfff; --color-accent-dark: #b8a3ff;
            --color-text: #6a4c6e; --color-text-light: #9b7a9f;
            --color-bg-main: #fff9fb; --color-bg-card: rgba(255, 255, 255, 0.92);
            --color-grid-line: rgba(255, 182, 217, 0.15);
            --shadow: 0 8px 20px rgba(255, 182, 217, 0.2); --shadow-hover: 0 12px 30px rgba(255, 182, 217, 0.35);
            --radius: 20px;
        }
        /* ç½‘æ ¼çº¸èƒŒæ™¯ */
        body { background-color: var(--color-bg-main); background-image: linear-gradient(var(--color-grid-line) 1px, transparent 1px), linear-gradient(90deg, var(--color-grid-line) 1px, transparent 1px); background-size: 20px 20px; min-height: 100vh; padding: 20px; color: var(--color-text); }
        .container { max-width: 1600px; margin: 0 auto; position: relative; }

        /* ========== é¡¶éƒ¨ä¸ªäººä¿¡æ¯æ æ ·å¼ ========== */
        .user-bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 15px 25px; background: var(--color-bg-card); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid rgba(255, 255, 255, 0.5); }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .avatar-container { cursor: pointer; position: relative; }
        .user-avatar { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid var(--color-primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .avatar-upload-btn { position: absolute; bottom: 0; right: 0; background: var(--color-primary); color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; border: 2px solid white; }
        .user-name-display { font-size: 2.2rem; font-weight: 700; background: linear-gradient(to right, var(--color-primary-dark), var(--color-accent-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .user-subtitle { font-size: 1rem; color: var(--color-text-light); font-weight: 300; margin-top: 5px; }

        /* ========== ä¸ªäººè®¾ç½®æ¨¡æ€æ¡†æ ·å¼ ========== */
        .settings-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--color-bg-card); width: 90%; max-width: 600px; max-height: 85vh; border-radius: var(--radius); padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); overflow-y: auto; }
        .modal-header { font-size: 1.8rem; color: var(--color-text); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--color-primary); display: flex; align-items: center; gap: 12px; }
        .setting-group { margin-bottom: 25px; }
        .setting-label { display: block; margin-bottom: 10px; font-weight: 600; color: var(--color-text); font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        .setting-input { width: 100%; padding: 12px 18px; border: 2px solid var(--color-primary); border-radius: 12px; font-size: 1rem; color: var(--color-text); background-color: rgba(255, 255, 255, 0.9); }
        .countdown-list { list-style: none; margin-top: 10px; }
        .countdown-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: rgba(255, 255, 255, 0.7); border-radius: 10px; margin-bottom: 10px; border-left: 4px solid var(--color-accent); }
        .countdown-item span { font-weight: 500; }
        .btn-small { padding: 6px 12px; font-size: 0.85rem; border-radius: 8px; border: none; cursor: pointer; }
        .btn-add { background: var(--color-primary); color: white; margin-top: 10px; }
        .btn-delete { background: #ff6b6b; color: white; }
        .theme-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .theme-option { padding: 15px; border-radius: 12px; cursor: pointer; text-align: center; font-weight: 600; border: 3px solid transparent; background: white; }
        .theme-option:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .theme-option.active { border-color: var(--color-text); }
        .modal-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 1px dashed var(--color-primary); }

        /* ========== ä¸»å†…å®¹åŒºåŸŸæ ·å¼ ========== */
        .main-content { display: flex; flex-wrap: wrap; gap: 30px; margin-bottom: 40px; }
        .editor-section, .entries-section, .export-panel, .import-panel { background: var(--color-bg-card); border-radius: var(--radius); padding: 30px; box-shadow: var(--shadow); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); align-self: flex-start; }
        .editor-section { flex: 1; min-width: 320px; }
        .entries-section { flex: 1.2; min-width: 320px; }
        .export-panel { flex: 0.8; min-width: 280px; }
        .import-panel { flex: 0.8; min-width: 280px; }
        .section-title { font-size: 1.6rem; color: var(--color-text); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px dashed var(--color-primary); display: flex; align-items: center; gap: 12px; }
        .form-row { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 200px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--color-text); font-size: 0.95rem; }
        .date-input, .food-input, .diary-text, .tags-input, .month-selector, .import-textarea { width: 100%; padding: 14px 18px; border: 2px solid var(--color-primary); border-radius: 12px; font-size: 1rem; color: var(--color-text); background-color: rgba(255, 255, 255, 0.9); transition: all 0.3s; }
        .import-textarea { height: 300px; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.5; resize: none; white-space: pre-wrap; }
        .date-input:focus, .food-input:focus, .diary-text:focus, .tags-input:focus, .import-textarea:focus { outline: none; border-color: var(--color-accent-dark); background-color: white; box-shadow: 0 0 0 3px rgba(216, 180, 254, 0.2); }
        .food-input { background-color: rgba(255, 254, 240, 0.7); border-color: var(--color-secondary-dark); }
        .diary-text { height: 180px; resize: vertical; margin-bottom: 20px; }
        .mood-selector { margin-bottom: 25px; }
        .mood-label { display: block; margin-bottom: 12px; font-weight: 600; color: var(--color-text); }
        .mood-options { display: flex; gap: 15px; flex-wrap: wrap; }
        .mood-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; padding: 10px 15px; border-radius: 12px; background: white; border: 2px solid transparent; transition: all 0.3s; min-width: 70px; }
        .mood-option:hover { transform: translateY(-3px); border-color: var(--color-primary); box-shadow: 0 5px 15px rgba(255, 182, 217, 0.3); }
        .mood-option.selected { background-color: var(--color-primary-light); border-color: var(--color-primary-dark); box-shadow: 0 5px 15px rgba(255, 182, 217, 0.4); }
        .mood-icon { font-size: 2.2rem; margin-bottom: 5px; }
        .mood-text { font-size: 0.85rem; color: var(--color-text-light); }
        .tag-selector { margin-bottom: 25px; }
        .tag-options { display: flex; gap: 10px; flex-wrap: wrap; }
        .tag-option { padding: 8px 16px; background: white; border: 2px solid var(--color-secondary-dark); border-radius: 20px; cursor: pointer; font-size: 0.9rem; color: var(--color-text); transition: all 0.3s; }
        .tag-option:hover { background-color: var(--color-secondary); transform: scale(1.05); }
        .tag-option.selected { background-color: var(--color-secondary-dark); border-color: var(--color-text-light); color: var(--color-text); font-weight: 600; }
        .image-upload-area { border: 2px dashed var(--color-accent); border-radius: 12px; padding: 25px; text-align: center; margin-bottom: 25px; background-color: rgba(217, 207, 255, 0.1); cursor: pointer; transition: all 0.3s; }
        .image-upload-area:hover { background-color: rgba(217, 207, 255, 0.2); border-color: var(--color-accent-dark); }
        .image-upload-area i { font-size: 2.5rem; color: var(--color-accent-dark); margin-bottom: 10px; }
        .image-preview { max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 15px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn { padding: 14px 28px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: linear-gradient(to right, var(--color-primary-dark), var(--color-accent-dark)); color: white; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }
        .btn-secondary { background-color: white; color: var(--color-text); border: 2px solid var(--color-primary); }
        .btn-secondary:hover { background-color: var(--color-primary-light); transform: translateY(-3px); }
        .btn-export, .btn-import { background: linear-gradient(to right, var(--color-secondary-dark), #ffcc00); color: var(--color-text); width: 100%; }
        .btn-export:hover, .btn-import:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(255, 204, 0, 0.3); }
        .actions { display: flex; justify-content: space-between; margin-top: 10px; }
        .search-box { margin-bottom: 25px; position: relative; }
        .search-input { width: 100%; padding: 14px 20px 14px 50px; border: 2px solid var(--color-primary); border-radius: 12px; font-size: 1rem; background-color: white; }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--color-primary-dark); }
        .entries-container { max-height: 700px; overflow-y: auto; padding-right: 10px; }
        .entry-item { background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 250, 253, 0.95)); border-radius: 18px; padding: 25px; margin-bottom: 20px; border-left: 5px solid var(--color-primary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: all 0.3s; position: relative; }
        .entry-item:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(255, 182, 217, 0.3); }
        .entry-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .entry-date { font-weight: 700; color: var(--color-text); font-size: 1.2rem; }
        .entry-countdowns { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .countdown-badge { background: linear-gradient(to right, var(--color-accent), var(--color-primary)); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        .entry-mood { display: flex; align-items: center; gap: 5px; font-size: 1.4rem; }
        .entry-tags { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .entry-tag { background-color: var(--color-secondary); color: var(--color-text); padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 500; }
        .entry-food { background-color: rgba(255, 250, 200, 0.5); border-left: 3px solid var(--color-secondary-dark); padding: 12px 15px; border-radius: 10px; margin: 15px 0; font-style: italic; color: var(--color-text); }
        .entry-content { color: var(--color-text); line-height: 1.6; margin: 15px 0; }
        .entry-image { max-width: 100%; max-height: 250px; border-radius: 12px; margin: 15px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .entry-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--color-primary); font-size: 0.85rem; color: var(--color-text-light); }
        .entry-actions { display: flex; gap: 15px; }
        .action-btn { background: none; border: none; cursor: pointer; color: var(--color-text-light); font-size: 0.9rem; transition: color 0.2s; display: flex; align-items: center; gap: 5px; }
        .action-btn:hover { color: var(--color-primary-dark); }
        .no-entries { text-align: center; padding: 60px 20px; color: var(--color-text-light); font-style: italic; }
        .empty-icon { font-size: 4rem; margin-bottom: 20px; color: var(--color-primary); opacity: 0.6; }
        footer { text-align: center; padding: 25px; color: var(--color-text-light); font-size: 0.9rem; border-top: 1px solid rgba(255, 182, 217, 0.3); margin-top: 30px; }
        @media (max-width: 1200px) { .main-content { flex-direction: column; } .editor-section, .entries-section, .export-panel, .import-panel { min-width: 100%; } .theme-options { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .user-name-display { font-size: 1.8rem; } .user-avatar { width: 60px; height: 60px; } .form-row { flex-direction: column; gap: 15px; } .form-group { min-width: 100%; } .theme-options { grid-template-columns: 1fr; } }
        .entries-container::-webkit-scrollbar { width: 8px; }
        .entries-container::-webkit-scrollbar-track { background: rgba(255, 182, 217, 0.1); border-radius: 10px; }
        .entries-container::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 10px; }
        .entries-container::-webkit-scrollbar-thumb:hover { background: var(--color-primary-dark); }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨ä¸ªäººä¿¡æ¯æ  -->
        <div class="user-bar">
            <div class="user-info">
                <div class="avatar-container" id="avatarContainer">
                    <img id="userAvatar" class="user-avatar" src="https://cdn-icons-png.flaticon.com/512/3237/3237472.png" alt="ç”¨æˆ·å¤´åƒ">
                    <div class="avatar-upload-btn">
                        <i class="fas fa-camera"></i>
                        <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                    </div>
                </div>
                <div>
                    <div id="userNameDisplay" class="user-name-display">æˆ‘çš„æ—¥è®°æœ¬</div>
                    <div class="user-subtitle">è®°å½•ç”Ÿæ´»æ¯ä¸€åˆ» âœ¨</div>
                </div>
            </div>
            <div class="user-countdowns" id="userCountdowns">
                <!-- å…¨å±€å€’è®¡æ—¶å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <!-- ä¸ªäººè®¾ç½®æ¨¡æ€æ¡† -->
        <div id="settingsModal" class="settings-modal">
            <div class="modal-content">
                <h2 class="modal-header"><i class="fas fa-user-cog"></i> ä¸ªäººè®¾ç½®</h2>
                <div class="setting-group">
                    <label class="setting-label"><i class="fas fa-user-edit"></i> åŸºæœ¬èµ„æ–™</label>
                    <input type="text" id="inputUserName" class="setting-input" placeholder="ä½ çš„æ˜µç§°" value="æˆ‘">
                    <div style="display: flex; gap:15px; margin-top:15px;">
                        <input type="number" id="inputUserAge" class="setting-input" placeholder="å¹´é¾„" min="1" max="120" style="flex:1;">
                        <input type="text" id="inputUserMotto" class="setting-input" placeholder="ä¸ªæ€§ç­¾å (å¯é€‰)" style="flex:2;">
                    </div>
                </div>
                <div class="setting-group">
                    <label class="setting-label"><i class="fas fa-clock"></i> å€’è®¡æ—¶ç®¡ç†</label>
                    <p style="font-size:0.9rem; color:var(--color-text-light); margin-bottom:10px;">æ·»åŠ é‡è¦æ—¥å­çš„å€’è®¡æ—¶ï¼Œå®ƒä»¬ä¼šæ˜¾ç¤ºåœ¨å¯¹åº”çš„æ—¥è®°æ—è¾¹ã€‚</p>
                    <div style="display: flex; gap:10px; margin-bottom:15px;">
                        <input type="text" id="inputCountdownName" class="setting-input" placeholder="äº‹ä»¶åç§° (å¦‚ï¼šé«˜è€ƒ)" style="flex:2;">
                        <input type="date" id="inputCountdownDate" class="setting-input" style="flex:1;">
                        <button id="addCountdownBtn" class="btn-small btn-add">æ·»åŠ </button>
                    </div>
                    <ul id="countdownList" class="countdown-list">
                        <!-- å€’è®¡æ—¶åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                </div>
                <div class="setting-group">
                    <label class="setting-label"><i class="fas fa-palette"></i> åˆ‡æ¢ä¸»é¢˜é…è‰²</label>
                    <div class="theme-options">
                        <div class="theme-option active" data-theme="pink" style="background:#ffeff6; color:#6a4c6e; border-color:#6a4c6e;">ğŸŒ¸ ç²‰è‰²å°‘å¥³</div>
                        <div class="theme-option" data-theme="blue" style="background:#e6f0ff; color:#1a365d; border-color:#1a365d;">ğŸŒ€ è“è‰²æ²‰ç¨³</div>
                        <div class="theme-option" data-theme="yellow" style="background:#fff9e6; color:#8a6d0f; border-color:#8a6d0f;">â˜€ï¸ é»„è‰²æ´»æ³¼</div>
                        <div class="theme-option" data-theme="green" style="background:#f0fff4; color:#22543d; border-color:#22543d;">ğŸƒ ç»¿è‰²æ¸…æ–°</div>
                        <div class="theme-option" data-theme="dark" style="background:#2d3748; color:#e2e8f0; border-color:#e2e8f0;">ğŸŒ™ é»‘è‰²æš—é»‘</div>
                        <div class="theme-option" data-theme="gray" style="background:#f7fafc; color:#4a5568; border-color:#4a5568;">â¬œ ç°ç™½ç®€çº¦</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="closeSettingsBtn" class="btn btn-secondary">å–æ¶ˆ</button>
                    <button id="saveSettingsBtn" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- å·¦ä¾§ï¼šå†™æ—¥è®°ç¼–è¾‘å™¨ -->
            <section class="editor-section">
                <h2 class="section-title"><i class="fas fa-feather-alt"></i> å†™ä¸‹ä»Šå¤©</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dateInput"><i class="far fa-calendar"></i> æ—¥æœŸ</label>
                        <input type="date" id="dateInput" class="date-input">
                    </div>
                    <div class="form-group">
                        <label for="foodInput"><i class="fas fa-utensils"></i> ä»Šæ—¥é¥®é£Ÿ</label>
                        <input type="text" id="foodInput" class="food-input" placeholder="æ—©é¤åƒäº†ä»€ä¹ˆï¼Ÿåˆé¤å‘¢ï¼Ÿ">
                    </div>
                </div>
                <div class="mood-selector">
                    <label class="mood-label"><i class="far fa-smile"></i> æ­¤åˆ»å¿ƒæƒ…</label>
                    <div class="mood-options">
                        <div class="mood-option" data-mood="happy"><span class="mood-icon">ğŸ˜Š</span><span class="mood-text">è¶…å¼€å¿ƒ</span></div>
                        <div class="mood-option" data-mood="love"><span class="mood-icon">ğŸ¥°</span><span class="mood-text">æœ‰çˆ±</span></div>
                        <div class="mood-option" data-mood="neutral"><span class="mood-icon">ğŸ˜Œ</span><span class="mood-text">å¹³é™</span></div>
                        <div class="mood-option" data-mood="sad"><span class="mood-icon">ğŸ˜”</span><span class="mood-text">å°ä½è½</span></div>
                        <div class="mood-option" data-mood="tired"><span class="mood-icon">ğŸ˜´</span><span class="mood-text">ç–²æƒ«</span></div>
                        <div class="mood-option" data-mood="excited"><span class="mood-icon">ğŸ¤©</span><span class="mood-text">å…´å¥‹</span></div>
                    </div>
                </div>
                <div class="tag-selector">
                    <label class="mood-label"><i class="fas fa-tags"></i> åˆ†ç±»æ ‡ç­¾</label>
                    <div class="tag-options">
                        <div class="tag-option" data-tag="æ—¥å¸¸">æ—¥å¸¸</div>
                        <div class="tag-option" data-tag="ç¾é£Ÿ">ç¾é£Ÿ</div>
                        <div class="tag-option" data-tag="æ—…è¡Œ">æ—…è¡Œ</div>
                        <div class="tag-option" data-tag="å·¥ä½œ">å·¥ä½œ</div>
                        <div class="tag-option" data-tag="å­¦ä¹ ">å­¦ä¹ </div>
                        <div class="tag-option" data-tag="æ¢¦å¢ƒ">æ¢¦å¢ƒ</div>
                    </div>
                </div>
                <label for="diaryText"><i class="fas fa-book-open"></i> æ—¥è®°æ­£æ–‡</label>
                <textarea id="diaryText" class="diary-text" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…å‘¢ï¼Ÿ"></textarea>
                <div class="image-upload-area" id="imageUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ (æ”¯æŒJPG, PNG)</p>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <img id="imagePreview" class="image-preview" alt="å›¾ç‰‡é¢„è§ˆ">
                </div>
                <div class="actions">
                    <button id="saveBtn" class="btn btn-primary"><i class="fas fa-save"></i> ä¿å­˜æ—¥è®°</button>
                    <button id="clearBtn" class="btn btn-secondary"><i class="fas fa-eraser"></i> æ¸…ç©º</button>
                </div>
            </section>

            <!-- ä¸­é—´ï¼šæ—¥è®°åˆ—è¡¨ -->
            <section class="entries-section">
                <h2 class="section-title"><i class="fas fa-history"></i> æˆ‘çš„æ—¥è®°</h2>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢æ—¥è®°å†…å®¹ã€é£Ÿç‰©æˆ–æ ‡ç­¾...">
                </div>
                <div class="entries-container" id="entriesContainer">
                    <!-- æ—¥è®°æ¡ç›®åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </section>

            <!-- å³ä¾§ï¼šæ•°æ®ç®¡ç†é¢æ¿ -->
            <section class="export-panel">
                <h2 class="section-title"><i class="fas fa-download"></i> æœˆåº¦å¯¼å‡º</h2>
                <div class="export-controls">
                    <label for="monthSelect">é€‰æ‹©æœˆä»½</label>
                    <input type="month" id="monthSelect" class="month-selector">
                    <button id="exportBtn" class="btn btn-export"><i class="fas fa-file-export"></i> ç”ŸæˆæœˆæŠ¥</button>
                </div>
                <label>å¯¼å‡ºæ–‡æœ¬ï¼ˆå¯å…¨é€‰å¤åˆ¶ï¼‰</label>
                <textarea id="exportOutput" class="import-textarea" readonly placeholder="ç‚¹å‡»â€œç”ŸæˆæœˆæŠ¥â€åï¼Œè¯¥æœˆçš„æ‰€æœ‰æ—¥è®°å°†ä»¥æ–‡æœ¬å½¢å¼æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚"></textarea>
            </section>

            <!-- æ–°å¢ï¼šæ•°æ®æ¢å¤é¢æ¿ -->
            <section class="import-panel">
                <h2 class="section-title"><i class="fas fa-upload"></i> æ•°æ®æ¢å¤</h2>
                <p style="font-size:0.9rem; color:var(--color-text-light); margin-bottom:15px;">ç²˜è´´ä¹‹å‰å¯¼å‡ºçš„å®Œæ•´æœˆæŠ¥æ–‡æœ¬ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æå¹¶æ¢å¤æ‰€æœ‰æ—¥è®°ã€‚</p>
                <label for="importTextarea">ç²˜è´´å¤‡ä»½æ–‡æœ¬</label>
                <textarea id="importTextarea" class="import-textarea" placeholder="è¯·å°†å®Œæ•´çš„æœˆæŠ¥å¤‡ä»½æ–‡æœ¬ç²˜è´´åœ¨æ­¤å¤„..."></textarea>
                <button id="importBtn" class="btn btn-import" style="margin-top:15px;"><i class="fas fa-file-import"></i> ä¸€é”®æ¢å¤æ—¥è®°</button>
                <p style="font-size:0.85rem; color:var(--color-text-light); text-align:center; margin-top:15px;">
                    âš ï¸ æ³¨æ„ï¼šè¿™ä¼šè¦†ç›–å½“å‰ç›¸åŒæ—¥æœŸçš„æ—¥è®°ã€‚
                </p>
            </section>
        </main>
        <footer>
            <p>ğŸŒ¸ ä½ çš„ç§äººèŠ±å›­ | æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨ä½ çš„è®¾å¤‡ä¸­ï¼Œå®ˆæŠ¤ä½ çš„æ¯ä¸€ä»½ç§˜å¯† ğŸŒ¸</p>
        </footer>
    </div>

    <script>
        // ========== å…¨å±€é…ç½®ä¸åˆå§‹åŒ– ==========
        // ç”¨æˆ·è®¾ç½®ï¼ˆåŒ…å«æ˜µç§°ã€å¤´åƒã€å€’è®¡æ—¶ã€ä¸»é¢˜ï¼‰
        let userSettings = {
            name: 'æˆ‘',
            age: '',
            motto: '',
            avatar: 'https://cdn-icons-png.flaticon.com/512/3237/3237472.png',
            countdowns: [],
            theme: 'pink'
        };
        // æ—¥è®°ç¼–è¾‘å™¨å½“å‰çŠ¶æ€
        let selectedMood = 'neutral';
        let selectedTags = [];
        let imageData = null;
        const now = new Date();

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ—¥æœŸ
        document.getElementById('dateInput').valueAsDate = now;
        document.getElementById('monthSelect').value = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');

        // ========== åŠ è½½ä¸ä¿å­˜ç”¨æˆ·è®¾ç½® ==========
        function loadUserSettings() {
            const saved = localStorage.getItem('diaryUserSettings');
            if (saved) {
                try {
                    userSettings = JSON.parse(saved);
                    applyUserSettings();
                } catch(e) {
                    console.error('åŠ è½½ç”¨æˆ·è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚', e);
                }
            }
            updateGlobalCountdowns();
        }
        function saveUserSettings() {
            localStorage.setItem('diaryUserSettings', JSON.stringify(userSettings));
        }
        function applyUserSettings() {
            document.getElementById('userNameDisplay').textContent = userSettings.name + ' çš„æ—¥è®°æœ¬';
            document.getElementById('inputUserName').value = userSettings.name;
            document.getElementById('userAvatar').src = userSettings.avatar;
            document.getElementById('inputUserAge').value = userSettings.age || '';
            document.getElementById('inputUserMotto').value = userSettings.motto || '';
            applyTheme(userSettings.theme);
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.theme === userSettings.theme);
            });
            renderCountdownList();
        }

        // ========== ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ ==========
        const themes = {
            pink: { primary: '#ffb6d9', primaryDark: '#ff8ec7', primaryLight: '#ffeff6', secondary: '#fff9b6', secondaryDark: '#ffeaa5', accent: '#d9cfff', accentDark: '#b8a3ff', text: '#6a4c6e', textLight: '#9b7a9f', bgMain: '#fff9fb', bgCard: 'rgba(255, 255, 255, 0.92)', gridLine: 'rgba(255, 182, 217, 0.15)' },
            blue: { primary: '#63b3ed', primaryDark: '#3182ce', primaryLight: '#ebf8ff', secondary: '#90cdf4', secondaryDark: '#4299e1', accent: '#9ae6b4', accentDark: '#68d391', text: '#2d3748', textLight: '#718096', bgMain: '#f7fafc', bgCard: 'rgba(255, 255, 255, 0.95)', gridLine: 'rgba(99, 179, 237, 0.15)' },
            yellow: { primary: '#f6e05e', primaryDark: '#d69e2e', primaryLight: '#fefcbf', secondary: '#faf089', secondaryDark: '#ecc94b', accent: '#9ae6b4', accentDark: '#68d391', text: '#744210', textLight: '#b7791f', bgMain: '#fffaf0', bgCard: 'rgba(255, 255, 255, 0.95)', gridLine: 'rgba(246, 224, 94, 0.15)' },
            green: { primary: '#68d391', primaryDark: '#38a169', primaryLight: '#c6f6d5', secondary: '#9ae6b4', secondaryDark: '#48bb78', accent: '#d6bcfa', accentDark: '#b794f4', text: '#22543d', textLight: '#38a169', bgMain: '#f0fff4', bgCard: 'rgba(255, 255, 255, 0.95)', gridLine: 'rgba(104, 211, 145, 0.15)' },
            dark: { primary: '#4fd1c7', primaryDark: '#319795', primaryLight: '#b2f5ea', secondary: '#81e6d9', secondaryDark: '#4fd1c7', accent: '#d6bcfa', accentDark: '#b794f4', text: '#e2e8f0', textLight: '#a0aec0', bgMain: '#1a202c', bgCard: 'rgba(45, 55, 72, 0.95)', gridLine: 'rgba(79, 209, 199, 0.15)' },
            gray: { primary: '#a0aec0', primaryDark: '#718096', primaryLight: '#edf2f7', secondary: '#cbd5e0', secondaryDark: '#a0aec0', accent: '#e2e8f0', accentDark: '#cbd5e0', text: '#4a5568', textLight: '#718096', bgMain: '#f7fafc', bgCard: 'rgba(255, 255, 255, 0.98)', gridLine: 'rgba(160, 174, 192, 0.15)' }
        };
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;
            const root = document.documentElement;
            root.style.setProperty('--color-primary', theme.primary);
            root.style.setProperty('--color-primary-dark', theme.primaryDark);
            root.style.setProperty('--color-primary-light', theme.primaryLight);
            root.style.setProperty('--color-secondary', theme.secondary);
            root.style.setProperty('--color-secondary-dark', theme.secondaryDark);
            root.style.setProperty('--color-accent', theme.accent);
            root.style.setProperty('--color-accent-dark', theme.accentDark);
            root.style.setProperty('--color-text', theme.text);
            root.style.setProperty('--color-text-light', theme.textLight);
            root.style.setProperty('--color-bg-main', theme.bgMain);
            root.style.setProperty('--color-bg-card', theme.bgCard);
            root.style.setProperty('--color-grid-line', theme.gridLine);
            userSettings.theme = themeName;
        }

        // ========== å¤´åƒä¸Šä¼ åŠŸèƒ½ ==========
        document.getElementById('avatarContainer').addEventListener('click', () => {
            document.getElementById('avatarUpload').click();
        });
        document.getElementById('avatarUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userSettings.avatar = e.target.result;
                    document.getElementById('userAvatar').src = userSettings.avatar;
                    saveUserSettings();
                };
                reader.readAsDataURL(file);
            }
        });

        // ========== è®¾ç½®æ¨¡æ€æ¡†æ§åˆ¶ ==========
        document.getElementById('avatarContainer').addEventListener('click', (e) => {
            if (!e.target.closest('#avatarUpload')) {
                document.getElementById('settingsModal').style.display = 'flex';
            }
        });
        document.getElementById('closeSettingsBtn').addEventListener('click', () => {
            document.getElementById('settingsModal').style.display = 'none';
            applyUserSettings(); // å–æ¶ˆæ—¶æ¢å¤åŸè®¾ç½®
        });
        document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            userSettings.name = document.getElementById('inputUserName').value.trim() || 'æˆ‘';
            userSettings.age = document.getElementById('inputUserAge').value;
            userSettings.motto = document.getElementById('inputUserMotto').value.trim();
            saveUserSettings();
            applyUserSettings();
            document.getElementById('settingsModal').style.display = 'none';
            renderDiaries(); // é‡æ–°æ¸²æŸ“æ—¥è®°ä»¥æ›´æ–°å€’è®¡æ—¶
        });
        document.querySelectorAll('.theme-option').forEach(opt => {
            opt.addEventListener('click', function() {
                applyTheme(this.dataset.theme);
                document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // ========== å€’è®¡æ—¶ç®¡ç†åŠŸèƒ½ ==========
        function renderCountdownList() {
            const listEl = document.getElementById('countdownList');
            listEl.innerHTML = '';
            userSettings.countdowns.forEach((cd, index) => {
                const li = document.createElement('li');
                li.className = 'countdown-item';
                const daysLeft = Math.ceil((new Date(cd.date) - now) / (1000*60*60*24));
                li.innerHTML = `
                    <span><i class="far fa-calendar-alt"></i> ${cd.name} (${daysLeft}å¤©)</span>
                    <button class="btn-small btn-delete" data-index="${index}">åˆ é™¤</button>
                `;
                listEl.appendChild(li);
            });
            // ç»‘å®šåˆ é™¤äº‹ä»¶
            listEl.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    userSettings.countdowns.splice(index, 1);
                    saveUserSettings();
                    renderCountdownList();
                    renderDiaries();
                    updateGlobalCountdowns();
                });
            });
        }
        document.getElementById('addCountdownBtn').addEventListener('click', () => {
            const name = document.getElementById('inputCountdownName').value.trim();
            const date = document.getElementById('inputCountdownDate').value;
            if (!name || !date) {
                alert('è¯·å¡«å†™äº‹ä»¶åç§°å’Œæ—¥æœŸ');
                return;
            }
            userSettings.countdowns.push({ name, date });
            document.getElementById('inputCountdownName').value = '';
            document.getElementById('inputCountdownDate').value = '';
            saveUserSettings();
            renderCountdownList();
            renderDiaries();
            updateGlobalCountdowns();
        });
        function updateGlobalCountdowns() {
            const container = document.getElementById('userCountdowns');
            if (userSettings.countdowns.length === 0) {
                container.innerHTML = '<div class="user-subtitle">ç‚¹å‡»å¤´åƒæ·»åŠ é‡è¦å€’è®¡æ—¶</div>';
                return;
            }
            let html = '<div style="display:flex; gap:15px; flex-wrap:wrap;">';
            userSettings.countdowns.forEach(cd => {
                const daysLeft = Math.ceil((new Date(cd.date) - now) / (1000*60*60*24));
                const color = daysLeft <= 30 ? '#ff6b6b' : daysLeft <= 90 ? '#ffa726' : '#4caf50';
                html += `
                    <div style="background:${color}; color:white; padding:8px 15px; border-radius:10px; font-size:0.9rem;">
                        <i class="far fa-clock"></i> ${cd.name}: <strong>${daysLeft}</strong>å¤©
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }
        function renderEntryCountdowns(entryDate) {
            if (!userSettings.countdowns.length) return '';
            const entryDateObj = new Date(entryDate);
            let html = '<div class="entry-countdowns">';
            userSettings.countdowns.forEach(cd => {
                const targetDate = new Date(cd.date);
                const daysDiff = Math.ceil((targetDate - entryDateObj) / (1000*60*60*24));
                if (Math.abs(daysDiff) <= 365) {
                    const label = daysDiff > 0 ? `è·ç¦»${cd.name}è¿˜æœ‰${daysDiff}å¤©` : `${cd.name}å·²è¿‡å»${-daysDiff}å¤©`;
                    html += `<span class="countdown-badge"><i class="far fa-clock"></i> ${label}</span>`;
                }
            });
            html += '</div>';
            return html;
        }

        // ========== æ ¸å¿ƒæ—¥è®°åŠŸèƒ½ï¼šå¿ƒæƒ…ã€æ ‡ç­¾ã€å›¾ç‰‡ ==========
        // 1. å¿ƒæƒ…é€‰æ‹©
        const moodOptions = document.querySelectorAll('.mood-option');
        moodOptions.forEach(option => {
            if (option.dataset.mood === 'neutral') option.classList.add('selected');
            option.addEventListener('click', function() {
                moodOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedMood = this.dataset.mood;
                console.log('å¿ƒæƒ…å·²é€‰æ‹©ï¼š', selectedMood); // è°ƒè¯•ç”¨
            });
        });

        // 2. æ ‡ç­¾é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰
        const tagOptions = document.querySelectorAll('.tag-option');
        tagOptions.forEach(option => {
            option.addEventListener('click', function() {
                const tag = this.dataset.tag;
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    selectedTags = selectedTags.filter(t => t !== tag);
                } else {
                    this.classList.add('selected');
                    selectedTags.push(tag);
                }
                console.log('å½“å‰æ ‡ç­¾ï¼š', selectedTags); // è°ƒè¯•ç”¨
            });
        });

        // 3. å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ
        const imageInput = document.getElementById('imageInput');
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imagePreview = document.getElementById('imagePreview');
        imageUploadArea.addEventListener('click', () => imageInput.click());
        imageInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    imagePreview.src = imageData;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // 4. ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ—¥è®°
        function loadDiaries() {
            const diaries = JSON.parse(localStorage.getItem('diaries')) || [];
            return diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // 5. ä¿å­˜æ—¥è®°åˆ°æœ¬åœ°å­˜å‚¨
        function saveDiary(diary) {
            const diaries = loadDiaries();
            const existingIndex = diaries.findIndex(d => d.date === diary.date);
            if (existingIndex !== -1) {
                if (confirm('åŒä¸€å¤©å·²å­˜åœ¨æ—¥è®°ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ')) {
                    diaries[existingIndex] = diary;
                } else {
                    return;
                }
            } else {
                diaries.push(diary);
            }
            localStorage.setItem('diaries', JSON.stringify(diaries));
            renderDiaries();
        }

        // 6. æ¸²æŸ“æ—¥è®°åˆ—è¡¨
        function renderDiaries(searchTerm = '') {
            const entriesContainer = document.getElementById('entriesContainer');
            const diaries = loadDiaries();
            const filteredDiaries = diaries.filter(diary =>
                diary.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
                diary.date.includes(searchTerm) ||
                diary.food?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                diary.tags?.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            entriesContainer.innerHTML = '';
            if (filteredDiaries.length === 0) {
                entriesContainer.innerHTML = `
                    <div class="no-entries">
                        <div class="empty-icon"><i class="fas fa-journal-whills"></i></div>
                        <p>${searchTerm ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥è®°' : 'è¿˜æ²¡æœ‰æ—¥è®°è®°å½•å“¦~'}</p>
                        <p>${searchTerm ? 'è¯•è¯•å…¶ä»–å…³é”®è¯å§ï¼' : 'å¿«å†™ä¸‹ç¬¬ä¸€ç¯‡æ—¥è®°å§ï¼'}</p>
                    </div>
                `;
                return;
            }
            filteredDiaries.forEach(diary => {
                const entryElement = document.createElement('div');
                entryElement.className = 'entry-item';
                const dateObj = new Date(diary.date);
                const formattedDate = dateObj.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
                const tagsHtml = diary.tags && diary.tags.length > 0 ? `<div class="entry-tags">${diary.tags.map(tag => `<span class="entry-tag">${tag}</span>`).join('')}</div>` : '';
                const foodHtml = diary.food ? `<div class="entry-food"><strong>ğŸ½ï¸ ä»Šæ—¥é¥®é£Ÿï¼š</strong>${diary.food}</div>` : '';
                const imageHtml = diary.image ? `<img src="${diary.image}" class="entry-image" alt="æ—¥è®°é…å›¾">` : '';
                const countdownHtml = renderEntryCountdowns(diary.date);
                entryElement.innerHTML = `
                    <div class="entry-header">
                        <div class="entry-date">${formattedDate}</div>
                        <div class="entry-mood" title="${diary.mood}">${getMoodIcon(diary.mood)}</div>
                    </div>
                    ${countdownHtml}
                    ${tagsHtml}
                    ${foodHtml}
                    <div class="entry-content">${diary.content}</div>
                    ${imageHtml}
                    <div class="entry-footer">
                        <div class="entry-length">${diary.content.length} å­—</div>
                        <div class="entry-actions">
                            <button class="action-btn view-btn" data-date="${diary.date}"><i class="fas fa-edit"></i> ç¼–è¾‘</button>
                            <button class="action-btn delete-btn" data-date="${diary.date}"><i class="fas fa-trash"></i> åˆ é™¤</button>
                        </div>
                    </div>
                `;
                entriesContainer.appendChild(entryElement);
            });
            document.querySelectorAll('.view-btn').forEach(btn => { btn.addEventListener('click', () => viewDiary(btn.dataset.date)); });
            document.querySelectorAll('.delete-btn').forEach(btn => { btn.addEventListener('click', () => deleteDiary(btn.dataset.date)); });
        }

        // 7. æŸ¥çœ‹/ç¼–è¾‘æ—¥è®°
        function viewDiary(date) {
            const diaries = loadDiaries();
            const diary = diaries.find(d => d.date === date);
            if (!diary) return;
            document.getElementById('dateInput').value = diary.date;
            document.getElementById('foodInput').value = diary.food || '';
            document.getElementById('diaryText').value = diary.content;
            moodOptions.forEach(opt => opt.classList.remove('selected'));
            const moodOpt = document.querySelector(`.mood-option[data-mood="${diary.mood}"]`);
            if (moodOpt) moodOpt.classList.add('selected');
            selectedMood = diary.mood;
            tagOptions.forEach(opt => opt.classList.remove('selected'));
            selectedTags = [];
            if (diary.tags) {
                diary.tags.forEach(tag => {
                    const tagOpt = document.querySelector(`.tag-option[data-tag="${tag}"]`);
                    if (tagOpt) {
                        tagOpt.classList.add('selected');
                        selectedTags.push(tag);
                    }
                });
            }
            if (diary.image) {
                imageData = diary.image;
                imagePreview.src = imageData;
                imagePreview.style.display = 'block';
            } else {
                imageData = null;
                imagePreview.style.display = 'none';
            }
            document.querySelector('.editor-section').scrollIntoView({ behavior: 'smooth' });
        }

        // 8. åˆ é™¤æ—¥è®°
        function deleteDiary(date) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ')) {
                const diaries = loadDiaries();
                const filteredDiaries = diaries.filter(diary => diary.date !== date);
                localStorage.setItem('diaries', JSON.stringify(filteredDiaries));
                renderDiaries();
            }
        }

        // 9. å·¥å…·å‡½æ•°ï¼šè·å–å¿ƒæƒ…å›¾æ ‡
        function getMoodIcon(mood) {
            const icons = { 'happy':'ğŸ˜Š', 'neutral':'ğŸ˜Œ', 'sad':'ğŸ˜”', 'excited':'ğŸ¤©', 'tired':'ğŸ˜´', 'love':'ğŸ¥°' };
            return icons[mood] || 'ğŸ˜Œ';
        }

        // ========== æ™ºèƒ½å¤‡ä»½å¯¼å…¥åŠŸèƒ½ ==========
        document.getElementById('importBtn').addEventListener('click', function() {
            const importText = document.getElementById('importTextarea').value.trim();
            if (!importText) { alert('è¯·ç²˜è´´å¤‡ä»½æ–‡æœ¬'); return; }
            if (!confirm('è¿™å°†è¦†ç›–ç°æœ‰æ—¥è®°ä¸­ç›¸åŒæ—¥æœŸçš„æ¡ç›®ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) return;
            const importedDiaries = parseBackupText(importText);
            if (importedDiaries.length === 0) { alert('æœªèƒ½ä»æ–‡æœ¬ä¸­è§£æå‡ºæœ‰æ•ˆçš„æ—¥è®°ã€‚è¯·æ£€æŸ¥æ ¼å¼ã€‚'); return; }
            const existingDiaries = loadDiaries();
            const dateMap = new Map();
            existingDiaries.forEach(d => dateMap.set(d.date, d));
            importedDiaries.forEach(newDiary => { dateMap.set(newDiary.date, newDiary); });
            const mergedDiaries = Array.from(dateMap.values());
            localStorage.setItem('diaries', JSON.stringify(mergedDiaries));
            alert(`æˆåŠŸå¯¼å…¥ ${importedDiaries.length} ç¯‡æ—¥è®°ï¼`);
            document.getElementById('importTextarea').value = '';
            renderDiaries();
        });
        function parseBackupText(text) {
            const diaries = [];
            const blocks = text.split(/ã€æ—¥è®° \d+ã€‘/);
            const moodMap = { 'ğŸ˜Š':'happy', 'ğŸ¥°':'love', 'ğŸ˜Œ':'neutral', 'ğŸ˜”':'sad', 'ğŸ˜´':'tired', 'ğŸ¤©':'excited' };
            blocks.forEach(block => {
                if (!block.trim()) return;
                const diary = { tags: [] };
                const dateMatch = block.match(/ğŸ“… æ—¥æœŸï¼š(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
                if (dateMatch) {
                    const [, year, month, day] = dateMatch;
                    diary.date = `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
                }
                const moodMatch = block.match(/ğŸ˜Š å¿ƒæƒ…ï¼š([ğŸ˜ŠğŸ¥°ğŸ˜ŒğŸ˜”ğŸ˜´ğŸ¤©]) (\w+)/);
                if (moodMatch) { diary.mood = moodMap[moodMatch[1]] || 'neutral'; }
                const tagsMatch = block.match(/ğŸ·ï¸ æ ‡ç­¾ï¼š(.+?)(?:\n|$)/);
                if (tagsMatch) { diary.tags = tagsMatch[1].split('ï¼Œ').map(t => t.trim()).filter(t => t); }
                const foodMatch = block.match(/ğŸ½ï¸ é¥®é£Ÿï¼š(.+?)(?:\n|$)/);
                if (foodMatch) { diary.food = foodMatch[1].trim(); }
                const contentMatch = block.match(/ğŸ“ æ­£æ–‡ï¼š\n([\s\S]+?)\n(?:\[æœ¬ç¯‡æ—¥è®°|------------------------------)/);
                if (contentMatch) { diary.content = contentMatch[1].trim(); }
                diary.image = null;
                diary.timestamp = new Date().toISOString();
                if (diary.date && diary.content) { diaries.push(diary); }
            });
            return diaries;
        }

        // ========== æœˆåº¦å¯¼å‡ºåŠŸèƒ½ ==========
        document.getElementById('exportBtn').addEventListener('click', function() {
            const monthValue = document.getElementById('monthSelect').value;
            if (!monthValue) { alert('è¯·å…ˆé€‰æ‹©æœˆä»½'); return; }
            const [year, month] = monthValue.split('-');
            const diaries = loadDiaries();
            const monthDiaries = diaries.filter(diary => {
                const diaryDate = new Date(diary.date);
                return diaryDate.getFullYear() == year && (diaryDate.getMonth() + 1) == month;
            });
            if (monthDiaries.length === 0) {
                document.getElementById('exportOutput').value = `ğŸ“… ${year}å¹´${month}æœˆ\n\nè¯¥æœˆä»½æ²¡æœ‰æ—¥è®°è®°å½•ã€‚`;
                return;
            }
            let exportText = `ğŸ“… ${year}å¹´${month}æœˆ æ—¥è®°å¤‡ä»½\n`;
            exportText += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n`;
            exportText += `å…±è®¡ ${monthDiaries.length} ç¯‡æ—¥è®°\n`;
            exportText += "=".repeat(40) + "\n\n";
            monthDiaries.forEach((diary, index) => {
                const dateObj = new Date(diary.date);
                const formattedDate = dateObj.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
                exportText += `ã€æ—¥è®° ${index + 1}ã€‘\n`;
                exportText += `ğŸ“… æ—¥æœŸï¼š${formattedDate}\n`;
                exportText += `ğŸ˜Š å¿ƒæƒ…ï¼š${getMoodIcon(diary.mood)} ${diary.mood}\n`;
                if (diary.tags && diary.tags.length > 0) { exportText += `ğŸ·ï¸ æ ‡ç­¾ï¼š${diary.tags.join('ï¼Œ ')}\n`; }
                if (diary.food) { exportText += `ğŸ½ï¸ é¥®é£Ÿï¼š${diary.food}\n`; }
                exportText += `\nğŸ“ æ­£æ–‡ï¼š\n${diary.content}\n`;
                exportText += `\n${diary.image ? '[æœ¬ç¯‡æ—¥è®°åŒ…å«å›¾ç‰‡]' : '[æœ¬ç¯‡æ—¥è®°æ— å›¾ç‰‡]'}\n`;
                exportText += "-".repeat(30) + "\n\n";
            });
            exportText += `å¤‡ä»½æç¤ºï¼šæ­¤æ–‡æœ¬æ–‡ä»¶åŒ…å«${monthDiaries.length}ç¯‡æ—¥è®°çš„å®Œæ•´å†…å®¹ã€‚\nè¯·å¦¥å–„ä¿å­˜ï¼Œå¦‚éœ€é‡æ–°å¯¼å…¥ï¼Œå¯æ‰‹åŠ¨å¯¹ç…§å½•å…¥ã€‚`;
            document.getElementById('exportOutput').value = exportText;
        });

        // ========== ç»‘å®šæ ¸å¿ƒæŒ‰é’®äº‹ä»¶ (ä¿å­˜ã€æ¸…ç©ºã€æœç´¢) ==========
        document.getElementById('saveBtn').addEventListener('click', function() {
            const date = document.getElementById('dateInput').value;
            const food = document.getElementById('foodInput').value.trim();
            const content = document.getElementById('diaryText').value.trim();
            if (!date) { alert('è¯·é€‰æ‹©æ—¥æœŸ'); return; }
            if (!content) { alert('è¯·å¡«å†™æ—¥è®°å†…å®¹'); return; }
            const diary = { date: date, mood: selectedMood, food: food, tags: [...selectedTags], content: content, image: imageData, timestamp: new Date().toISOString() };
            console.log('æ­£åœ¨ä¿å­˜æ—¥è®°ï¼š', diary); // è°ƒè¯•ç”¨
            saveDiary(diary);
            // æ¸…ç©ºè¡¨å•
            document.getElementById('dateInput').valueAsDate = new Date();
            document.getElementById('foodInput').value = '';
            document.getElementById('diaryText').value = '';
            imageData = null;
            imagePreview.style.display = 'none';
            imageInput.value = '';
            moodOptions.forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.mood-option[data-mood="neutral"]').classList.add('selected');
            selectedMood = 'neutral';
            tagOptions.forEach(opt => opt.classList.remove('selected'));
            selectedTags = [];
            alert('æ—¥è®°ä¿å­˜æˆåŠŸï¼âœ¨');
        });
        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰ç¼–è¾‘çš„å†…å®¹å—ï¼Ÿ')) {
                document.getElementById('dateInput').valueAsDate = new Date();
                document.getElementById('foodInput').value = '';
                document.getElementById('diaryText').value = '';
                imageData = null;
                imagePreview.style.display = 'none';
                imageInput.value = '';
                moodOptions.forEach(opt => opt.classList.remove('selected'));
                document.querySelector('.mood-option[data-mood="neutral"]').classList.add('selected');
                selectedMood = 'neutral';
                tagOptions.forEach(opt => opt.classList.remove('selected'));
                selectedTags = [];
            }
        });
        document.getElementById('searchInput').addEventListener('input', function() {
            renderDiaries(this.value);
        });

        // ========== é¡µé¢åˆå§‹åŒ– ==========
        loadUserSettings();
        renderDiaries();
        console.log('ğŸ‰ æ—¥è®°æœ¬ (å®Œæ•´ä¿®å¤ç‰ˆ) å·²æˆåŠŸåŠ è½½ï¼');
    </script>
</body>
</html>