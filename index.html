<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ—¥è®°æœ¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== CSS å˜é‡ (ç”¨äºä¸»é¢˜åˆ‡æ¢) ========== */
        :root {
            /* é»˜è®¤ç»å…¸æ—¥è®°ä¸»é¢˜ */
            --primary-color: #4a6fa5;
            --primary-light: #e8f4ff;
            --secondary-color: #ffb6d9;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        /* ç¤¾äº¤åª’ä½“ (X) ä¸»é¢˜å˜é‡ - é€šè¿‡JSåˆ‡æ¢ */
        .theme-social {
            --primary-color: #1d9bf0;
            --primary-light: #e8f6ff;
            --secondary-color: #ff6b9d;
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --text-color: #0f1419;
            --text-light: #536471;
            --border-color: #eff3f4;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --radius: 16px;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* æš—è‰²ä¸»é¢˜å˜é‡ */
        .theme-dark {
            --primary-color: #4fd1c7;
            --primary-light: #2d3748;
            --secondary-color: #9f7aea;
            --bg-color: #1a202c;
            --card-bg: #2d3748;
            --text-color: #e2e8f0;
            --text-light: #a0aec0;
            --border-color: #4a5568;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, border-color 0.3s;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ========== é¡¶éƒ¨æ  ========== */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            cursor: pointer;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        /* ========== ä¸»å†…å®¹åŒº ========== */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* ========== æ—¥è®°ç¼–è¾‘å™¨å¡ç‰‡ ========== */
        .editor-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
        }

        .form-textarea {
            min-height: 180px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag-option {
            padding: 8px 16px;
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .tag-option:hover {
            transform: translateY(-2px);
        }

        .tag-option.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .mood-grid, .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .mood-option, .weather-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            border-radius: 10px;
            background-color: var(--card-bg);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .mood-option:hover, .weather-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .mood-option.selected, .weather-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .mood-icon, .weather-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .mood-text, .weather-text {
            font-size: 0.9rem;
            text-align: center;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* ========== æ—¥è®°åˆ—è¡¨ & è¯„è®ºåŒº ========== */
        .diary-list {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            max-height: 800px;
            overflow-y: auto;
        }

        .diary-item {
            border-bottom: 1px solid var(--border-color);
            padding: 25px 0;
        }

        .diary-item:last-child {
            border-bottom: none;
        }

        .diary-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .diary-date {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .diary-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .diary-content {
            margin: 20px 0;
            line-height: 1.7;
        }

        .diary-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .diary-tag {
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        /* è¯„è®ºåŒº */
        .comments-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px dashed var(--border-color);
        }

        .comments-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comment-item {
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary-color);
        }

        .comment-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .add-comment {
            margin-top: 20px;
        }

        .comment-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 10px;
            font-family: inherit;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        /* ========== ä¾§è¾¹æ  (è®¾ç½®ä¸æ•°æ®ç®¡ç†) ========== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .settings-card, .data-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .theme-selector, .interface-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .theme-btn, .interface-btn {
            padding: 15px 10px;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .theme-btn:hover, .interface-btn:hover {
            border-color: var(--primary-color);
        }

        .theme-btn.active, .interface-btn.active {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .export-controls {
            margin-top: 20px;
        }

        .data-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            resize: vertical;
        }

        .hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 10px;
        }

        /* ========== æ¨¡æ€æ¡† (ç”¨æˆ·è®¾ç½®) ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 500px;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--text-light);
            cursor: pointer;
            line-height: 1;
        }

        .avatar-upload {
            text-align: center;
            margin: 20px 0;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--primary-color);
            margin-bottom: 15px;
            cursor: pointer;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* ========== å·¥å…·ç±» ========== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-3 { margin-top: 15px; }
        .mb-3 { margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="logo-area">
                <i class="fas fa-book-open logo-icon"></i>
                <h1 id="pageTitle" class="page-title">æˆ‘çš„æ—¥è®°æœ¬</h1>
            </div>
            <div class="user-controls">
                <button id="settingsToggle" class="icon-btn" title="è®¾ç½®">
                    <i class="fas fa-cog"></i>
                </button>
                <img id="userAvatar" class="avatar" src="https://cdn-icons-png.flaticon.com/512/3237/3237472.png" alt="å¤´åƒ" title="ç‚¹å‡»ä¿®æ”¹å¤´åƒå’Œåç§°">
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-layout">
            <!-- å·¦ä¾§ï¼šç¼–è¾‘å™¨ä¸æ—¥è®°åˆ—è¡¨ -->
            <div class="main-content">
                <!-- æ—¥è®°ç¼–è¾‘å™¨ -->
                <section class="editor-card">
                    <h2 class="card-title"><i class="fas fa-edit"></i> è®°å½•ä»Šå¤©</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label"><i class="far fa-calendar"></i> æ—¥æœŸ</label>
                            <input type="date" id="dateInput" class="form-input" value="">
                        </div>
                        <div class="form-group">
                            <label class="form-label"><i class="fas fa-utensils"></i> ä»Šæ—¥ç¾é£Ÿ</label>
                            <input type="text" id="foodInput" class="form-input" placeholder="åƒäº†ä»€ä¹ˆå¥½åƒçš„ï¼Ÿ">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label"><i class="far fa-smile"></i> å¿ƒæƒ…</label>
                        <div class="mood-grid">
                            <div class="mood-option" data-mood="happy">
                                <span class="mood-icon">ğŸ˜Š</span>
                                <span class="mood-text">å¼€å¿ƒ</span>
                            </div>
                            <div class="mood-option" data-mood="excited">
                                <span class="mood-icon">ğŸ¤©</span>
                                <span class="mood-text">å…´å¥‹</span>
                            </div>
                            <div class="mood-option" data-mood="love">
                                <span class="mood-icon">ğŸ¥°</span>
                                <span class="mood-text">æœ‰çˆ±</span>
                            </div>
                            <div class="mood-option" data-mood="peaceful">
                                <span class="mood-icon">ğŸ˜Œ</span>
                                <span class="mood-text">å¹³å’Œ</span>
                            </div>
                            <div class="mood-option" data-mood="grateful">
                                <span class="mood-icon">ğŸ™</span>
                                <span class="mood-text">æ„Ÿæ©</span>
                            </div>
                            <div class="mood-option" data-mood="sad">
                                <span class="mood-icon">ğŸ˜”</span>
                                <span class="mood-text">ä½è½</span>
                            </div>
                            <div class="mood-option" data-mood="tired">
                                <span class="mood-icon">ğŸ˜´</span>
                                <span class="mood-text">ç–²æƒ«</span>
                            </div>
                            <div class="mood-option" data-mood="angry">
                                <span class="mood-icon">ğŸ˜ </span>
                                <span class="mood-text">ç”Ÿæ°”</span>
                            </div>
                            <div class="mood-option" data-mood="anxious">
                                <span class="mood-icon">ğŸ˜°</span>
                                <span class="mood-text">ç„¦è™‘</span>
                            </div>
                            <div class="mood-option" data-mood="sick">
                                <span class="mood-icon">ğŸ¤’</span>
                                <span class="mood-text">ä¸é€‚</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-cloud"></i> å¤©æ°”</label>
                        <div class="weather-grid">
                            <div class="weather-option" data-weather="sunny">
                                <span class="weather-icon">â˜€ï¸</span>
                                <span class="weather-text">æ™´å¤©</span>
                            </div>
                            <div class="weather-option" data-weather="cloudy">
                                <span class="weather-icon">â›…</span>
                                <span class="weather-text">å¤šäº‘</span>
                            </div>
                            <div class="weather-option" data-weather="rainy">
                                <span class="weather-icon">ğŸŒ§ï¸</span>
                                <span class="weather-text">é›¨å¤©</span>
                            </div>
                            <div class="weather-option" data-weather="snowy">
                                <span class="weather-icon">â„ï¸</span>
                                <span class="weather-text">é›ªå¤©</span>
                            </div>
                            <div class="weather-option" data-weather="windy">
                                <span class="weather-icon">ğŸ’¨</span>
                                <span class="weather-text">åˆ®é£</span>
                            </div>
                            <div class="weather-option" data-weather="stormy">
                                <span class="weather-icon">â›ˆï¸</span>
                                <span class="weather-text">é›·æš´</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-tags"></i> åˆ†ç±»æ ‡ç­¾</label>
                        <div class="tag-selector">
                            <div class="tag-option" data-tag="æ—¥å¸¸">æ—¥å¸¸</div>
                            <div class="tag-option" data-tag="å·¥ä½œ">å·¥ä½œ</div>
                            <div class="tag-option" data-tag="å­¦ä¹ ">å­¦ä¹ </div>
                            <div class="tag-option" data-tag="ç¾é£Ÿ">ç¾é£Ÿ</div>
                            <div class="tag-option" data-tag="æ—…è¡Œ">æ—…è¡Œ</div>
                            <div class="tag-option" data-tag="å¥åº·">å¥åº·</div>
                            <div class="tag-option" data-tag="å®¶åº­">å®¶åº­</div>
                            <div class="tag-option" data-tag="æœ‹å‹">æœ‹å‹</div>
                            <div class="tag-option" data-tag="åˆ›æ„">åˆ›æ„</div>
                            <div class="tag-option" data-tag="æ¢¦å¢ƒ">æ¢¦å¢ƒ</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-book-open"></i> æ—¥è®°æ­£æ–‡</label>
                        <textarea id="diaryText" class="form-textarea" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå†™ä¸‹ä½ çš„æƒ³æ³•..."></textarea>
                    </div>

                    <div class="actions">
                        <button id="clearBtn" class="btn btn-secondary">
                            <i class="fas fa-eraser"></i> æ¸…ç©º
                        </button>
                        <button id="saveDiaryBtn" class="btn btn-primary">
                            <i class="fas fa-save"></i> ä¿å­˜æ—¥è®°
                        </button>
                    </div>
                </section>

                <!-- æ—¥è®°åˆ—è¡¨ä¸è¯„è®ºåŒº -->
                <section class="diary-list" id="diaryListContainer">
                    <!-- æ—¥è®°å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    <div class="text-center" id="emptyState">
                        <i class="fas fa-journal-whills" style="font-size:4rem; color:var(--text-light); opacity:0.5; margin:40px 0 20px;"></i>
                        <h3 style="color:var(--text-light);">è¿˜æ²¡æœ‰æ—¥è®°</h3>
                        <p>å†™ä¸‹ä½ çš„ç¬¬ä¸€ç¯‡æ—¥è®°å§ï¼</p>
                    </div>
                </section>
            </div>

            <!-- å³ä¾§ï¼šä¾§è¾¹æ  (è®¾ç½®ä¸æ•°æ®ç®¡ç†) -->
            <div class="sidebar">
                <!-- ç•Œé¢ä¸ä¸»é¢˜è®¾ç½® -->
                <section class="settings-card">
                    <h3 class="card-title"><i class="fas fa-sliders-h"></i> ç•Œé¢è®¾ç½®</h3>
                    
                    <div class="form-group">
                        <label class="form-label">ç•Œé¢é£æ ¼</label>
                        <div class="interface-selector">
                            <div class="interface-btn active" data-interface="classic">
                                <i class="fas fa-book"></i> ç»å…¸æ—¥è®°
                            </div>
                            <div class="interface-btn" data-interface="social">
                                <i class="fas fa-comment-dots"></i> ç¤¾äº¤åª’ä½“
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ä¸»é¢˜é…è‰²</label>
                        <div class="theme-selector">
                            <div class="theme-btn active" data-theme="default">é»˜è®¤è“</div>
                            <div class="theme-btn" data-theme="social">Twitterè“</div>
                            <div class="theme-btn" data-theme="dark">æ·±å¤œæ¨¡å¼</div>
                            <div class="theme-btn" data-theme="pink">å°‘å¥³ç²‰</div>
                        </div>
                    </div>
                </section>

                <!-- æ•°æ®ç®¡ç† -->
                <section class="data-card">
                    <h3 class="card-title"><i class="fas fa-database"></i> æ•°æ®ç®¡ç†</h3>
                    
                    <div class="export-controls">
                        <label class="form-label">å¯¼å‡ºæ—¥è®° (æŒ‰æœˆä»½)</label>
                        <input type="month" id="exportMonth" class="form-input mb-3">
                        <button id="exportBtn" class="btn btn-primary" style="width:100%;">
                            <i class="fas fa-download"></i> ç”Ÿæˆå¹¶å¤åˆ¶æœˆæŠ¥
                        </button>
                        <p class="hint">ç”Ÿæˆè¯¥æœˆæ‰€æœ‰æ—¥è®°çš„å¤‡ä»½æ–‡æœ¬ï¼Œå¹¶è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚</p>
                    </div>

                    <div class="mt-3">
                        <label class="form-label">å¯¼å…¥/æ¢å¤æ—¥è®°</label>
                        <p class="hint">ç²˜è´´ä¹‹å‰å¯¼å‡ºçš„å®Œæ•´å¤‡ä»½æ–‡æœ¬ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æã€‚</p>
                        <textarea id="importTextarea" class="data-textarea" placeholder="è¯·å°†å¤‡ä»½æ–‡æœ¬ç²˜è´´åœ¨æ­¤å¤„..."></textarea>
                        <button id="importBtn" class="btn btn-secondary" style="width:100%;">
                            <i class="fas fa-upload"></i> ä¸€é”®å¯¼å…¥æ—¥è®°
                        </button>
                        <p class="hint" style="color:#e74c3c;">æ³¨æ„ï¼šä¼šè¦†ç›–ç›¸åŒæ—¥æœŸçš„æ—¥è®°ä¸»ç¯‡ï¼Œä½†ä¿ç•™å…¶è¯„è®ºåŒºã€‚</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="userSettingsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user-cog"></i> ç”¨æˆ·è®¾ç½®</h2>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            
            <div class="avatar-upload">
                <img id="avatarPreview" class="avatar-preview" src="https://cdn-icons-png.flaticon.com/512/3237/3237472.png" alt="å¤´åƒé¢„è§ˆ">
                <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
                <button id="changeAvatarBtn" class="btn btn-secondary">
                    <i class="fas fa-camera"></i> æ›´æ¢å¤´åƒ
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä½ çš„æ˜µç§°</label>
                <input type="text" id="userNameInput" class="form-input" placeholder="è¾“å…¥ä½ çš„åå­—" value="æˆ‘">
                <p class="hint">æ­¤åç§°å°†æ˜¾ç¤ºåœ¨æ ‡é¢˜â€œXXçš„æ—¥è®°æœ¬â€ä¸­ã€‚</p>
            </div>
            
            <div class="modal-footer">
                <button id="cancelSettingsBtn" class="btn btn-secondary">å–æ¶ˆ</button>
                <button id="saveSettingsBtn" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€çŠ¶æ€ä¸é…ç½® ==========
        const APP_STORAGE_KEYS = {
            USER: 'diaryUserSettings',
            DIARIES: 'diaries',
            COMMENTS: 'diaryComments'
        };

        let userSettings = {
            name: 'æˆ‘',
            avatar: 'https://cdn-icons-png.flaticon.com/512/3237/3237472.png',
            theme: 'default',
            interface: 'classic'
        };

        let currentEditorState = {
            selectedMood: 'peaceful',
            selectedWeather: 'sunny',
            selectedTags: [],
            editingDiaryId: null // ç”¨äºåŒºåˆ†æ–°å¢è¿˜æ˜¯è¡¥å……
        };

        // ========== åˆå§‹åŒ–å‡½æ•° ==========
        function initApp() {
            console.log('æ­£åœ¨åˆå§‹åŒ–æ—¥è®°æœ¬...');
            
            // åŠ è½½ç”¨æˆ·è®¾ç½®
            loadUserSettings();
            
            // è®¾ç½®ä»Šå¤©ä¸ºé»˜è®¤æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            
            // ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
            bindAllEventListeners();
            
            // åˆå§‹æ¸²æŸ“
            renderDiaryList();
            
            console.log('æ—¥è®°æœ¬åˆå§‹åŒ–å®Œæˆï¼');
        }

        // ========== æ•°æ®å­˜å‚¨ä¸åŠ è½½ ==========
        function loadUserSettings() {
            const saved = localStorage.getItem(APP_STORAGE_KEYS.USER);
            if (saved) {
                try {
                    userSettings = JSON.parse(saved);
                    applyUserSettings();
                } catch(e) {
                    console.error('åŠ è½½ç”¨æˆ·è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼:', e);
                }
            }
        }

        function saveUserSettings() {
            localStorage.setItem(APP_STORAGE_KEYS.USER, JSON.stringify(userSettings));
        }

        function loadDiaries() {
            const saved = localStorage.getItem(APP_STORAGE_KEYS.DIARIES);
            return saved ? JSON.parse(saved) : [];
        }

        function saveDiaries(diaries) {
            localStorage.setItem(APP_STORAGE_KEYS.DIARIES, JSON.stringify(diaries));
        }

        function loadComments() {
            const saved = localStorage.getItem(APP_STORAGE_KEYS.COMMENTS);
            return saved ? JSON.parse(saved) : {};
        }

        function saveComments(comments) {
            localStorage.setItem(APP_STORAGE_KEYS.COMMENTS, JSON.stringify(comments));
        }

        // ========== åº”ç”¨è®¾ç½®åˆ°ç•Œé¢ ==========
        function applyUserSettings() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.getElementById('pageTitle').textContent = `${userSettings.name}çš„æ—¥è®°æœ¬`;
            document.getElementById('userNameInput').value = userSettings.name;
            
            // æ›´æ–°å¤´åƒ
            document.getElementById('userAvatar').src = userSettings.avatar;
            document.getElementById('avatarPreview').src = userSettings.avatar;
            
            // åº”ç”¨ä¸»é¢˜
            document.body.className = `theme-${userSettings.theme}`;
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === userSettings.theme);
            });
            
            // åº”ç”¨ç•Œé¢é£æ ¼
            document.querySelectorAll('.interface-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.interface === userSettings.interface);
            });
        }

        // ========== æ ¸å¿ƒæ—¥è®°åŠŸèƒ½ ==========
        function getCurrentDiaryData() {
            const date = document.getElementById('dateInput').value;
            const food = document.getElementById('foodInput').value.trim();
            const content = document.getElementById('diaryText').value.trim();
            
            if (!date) {
                alert('è¯·é€‰æ‹©æ—¥æœŸ');
                return null;
            }
            
            // è‡³å°‘éœ€è¦å¡«å†™å†…å®¹ã€å¿ƒæƒ…ã€å¤©æ°”ã€ç¾é£Ÿæˆ–æ ‡ç­¾ä¸­çš„ä¸€é¡¹
            if (!content && currentEditorState.selectedTags.length === 0 && !food) {
                alert('è¯·è‡³å°‘å¡«å†™æ—¥è®°å†…å®¹ã€é€‰æ‹©å¿ƒæƒ…/å¤©æ°”ã€å¡«å†™ç¾é£Ÿæˆ–é€‰æ‹©æ ‡ç­¾ä¸­çš„ä¸€é¡¹');
                return null;
            }
            
            return {
                id: currentEditorState.editingDiaryId || `diary_${Date.now()}`,
                date: date,
                mood: currentEditorState.selectedMood,
                weather: currentEditorState.selectedWeather,
                food: food,
                tags: [...currentEditorState.selectedTags],
                content: content,
                createdAt: new Date().toISOString()
            };
        }

        function saveNewDiary() {
            const diaryData = getCurrentDiaryData();
            if (!diaryData) return false;
            
            const diaries = loadDiaries();
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒä¸€å¤©çš„æ—¥è®°ï¼ˆä¸»ç¯‡ï¼‰
            const existingIndex = diaries.findIndex(d => d.date === diaryData.date && !d.isComment);
            
            if (existingIndex !== -1) {
                // æ”¹ä¸ºè¡¥å……æ¨¡å¼ï¼šä¿å­˜ä¸ºâ€œè¯„è®ºâ€
                saveAsComment(diaryData);
                alert(`${formatDate(diaryData.date)} å·²æœ‰ä¸»æ—¥è®°ï¼Œå·²ä¸ºæ‚¨ä¿å­˜ä¸ºè¡¥å……è®°å½•ï¼ˆåœ¨è¯„è®ºåŒºæŸ¥çœ‹ï¼‰ã€‚`);
            } else {
                // ä¿å­˜ä¸ºæ–°ä¸»æ—¥è®°
                diaryData.isComment = false;
                diaries.push(diaryData);
                saveDiaries(diaries);
                alert('æ—¥è®°ä¿å­˜æˆåŠŸï¼');
            }
            
            resetEditor();
            renderDiaryList();
            return true;
        }

        function saveAsComment(diaryData) {
            diaryData.isComment = true;
            diaryData.parentDate = diaryData.date; // å…³è”åˆ°ä¸»æ—¥è®°
            diaryData.id = `comment_${Date.now()}`;
            
            const comments = loadComments();
            if (!comments[diaryData.date]) {
                comments[diaryData.date] = [];
            }
            comments[diaryData.date].push(diaryData);
            saveComments(comments);
        }

        function getCommentsForDate(date) {
            const comments = loadComments();
            return comments[date] || [];
        }

        function resetEditor() {
            document.getElementById('diaryText').value = '';
            document.getElementById('foodInput').value = '';
            
            // é‡ç½®ä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            
            // é‡ç½®é€‰æ‹©
            currentEditorState.selectedMood = 'peaceful';
            currentEditorState.selectedWeather = 'sunny';
            currentEditorState.selectedTags = [];
            currentEditorState.editingDiaryId = null;
            
            // æ›´æ–°UIé€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.mood-option, .weather-option, .tag-option').forEach(el => {
                el.classList.remove('selected');
            });
            
            // è®¾ç½®é»˜è®¤é€‰ä¸­é¡¹
            document.querySelector('.mood-option[data-mood="peaceful"]').classList.add('selected');
            document.querySelector('.weather-option[data-weather="sunny"]').classList.add('selected');
        }

        // ========== æ¸²æŸ“åŠŸèƒ½ ==========
        function renderDiaryList() {
            const container = document.getElementById('diaryListContainer');
            const diaries = loadDiaries().filter(d => !d.isComment); // åªæ˜¾ç¤ºä¸»æ—¥è®°
            const emptyState = document.getElementById('emptyState');
            
            if (diaries.length === 0) {
                container.innerHTML = '<div id="emptyState" class="text-center"><i class="fas fa-journal-whills" style="font-size:4rem; color:var(--text-light); opacity:0.5; margin:40px 0 20px;"></i><h3 style="color:var(--text-light);">è¿˜æ²¡æœ‰æ—¥è®°</h3><p>å†™ä¸‹ä½ çš„ç¬¬ä¸€ç¯‡æ—¥è®°å§ï¼</p></div>';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // æŒ‰æ—¥æœŸå€’åºæ’åº
            diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '';
            diaries.forEach(diary => {
                const comments = getCommentsForDate(diary.date);
                html += renderDiaryItem(diary, comments);
            });
            
            container.innerHTML = html;
            
            // ä¸ºæ¯ä¸ªæ—¥è®°é¡¹ç»‘å®šäº‹ä»¶
            diaries.forEach(diary => {
                const editBtn = document.querySelector(`[data-diary-id="${diary.id}"] .edit-btn`);
                const deleteBtn = document.querySelector(`[data-diary-id="${diary.id}"] .delete-btn`);
                const addCommentBtn = document.querySelector(`[data-diary-id="${diary.id}"] .add-comment-btn`);
                const commentForm = document.querySelector(`[data-diary-id="${diary.id}"] .comment-form`);
                
                if (editBtn) editBtn.addEventListener('click', () => editDiary(diary.id));
                if (deleteBtn) deleteBtn.addEventListener('click', () => deleteDiary(diary.id));
                if (addCommentBtn) addCommentBtn.addEventListener('click', () => {
                    commentForm.classList.toggle('hidden');
                });
                
                const saveCommentBtn = document.querySelector(`[data-diary-id="${diary.id}"] .save-comment-btn`);
                if (saveCommentBtn) saveCommentBtn.addEventListener('click', () => saveComment(diary.date));
            });
        }

        function renderDiaryItem(diary, comments) {
            const moodIcons = {
                happy: 'ğŸ˜Š', excited: 'ğŸ¤©', love: 'ğŸ¥°', peaceful: 'ğŸ˜Œ',
                grateful: 'ğŸ™', sad: 'ğŸ˜”', tired: 'ğŸ˜´', angry: 'ğŸ˜ ',
                anxious: 'ğŸ˜°', sick: 'ğŸ¤’'
            };
            
            const weatherIcons = {
                sunny: 'â˜€ï¸', cloudy: 'â›…', rainy: 'ğŸŒ§ï¸',
                snowy: 'â„ï¸', windy: 'ğŸ’¨', stormy: 'â›ˆï¸'
            };
            
            const date = new Date(diary.date);
            const formattedDate = date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const tagsHtml = diary.tags.map(tag => 
                `<span class="diary-tag">${tag}</span>`
            ).join('');
            
            const commentsHtml = comments.length > 0 ? comments.map(comment => `
                <div class="comment-item">
                    <div class="comment-meta">
                        <span>${formatTime(comment.createdAt)}</span>
                        <span>${getMoodText(comment.mood)} ${weatherIcons[comment.weather] || ''}</span>
                    </div>
                    <div class="diary-content">${comment.content || ''}</div>
                    ${comment.food ? `<div><i class="fas fa-utensils"></i> ${comment.food}</div>` : ''}
                    ${comment.tags.length > 0 ? `<div class="diary-tags">${comment.tags.map(t => `<span class="diary-tag">${t}</span>`).join('')}</div>` : ''}
                </div>
            `).join('') : '<p style="color:var(--text-light); font-style:italic;">æš‚æ— è¡¥å……è®°å½•</p>';
            
            return `
                <div class="diary-item" data-diary-id="${diary.id}">
                    <div class="diary-header">
                        <div class="diary-date">${formattedDate}</div>
                        <div>
                            <button class="icon-btn edit-btn" title="ç¼–è¾‘ä¸»æ—¥è®°"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn delete-btn" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="diary-meta">
                        <span class="meta-item">${moodIcons[diary.mood] || 'ğŸ˜Š'} ${getMoodText(diary.mood)}</span>
                        <span class="meta-item">${weatherIcons[diary.weather] || 'â˜€ï¸'} ${getWeatherText(diary.weather)}</span>
                        ${diary.food ? `<span class="meta-item"><i class="fas fa-utensils"></i> ${diary.food}</span>` : ''}
                    </div>
                    
                    ${diary.tags.length > 0 ? `<div class="diary-tags">${tagsHtml}</div>` : ''}
                    
                    <div class="diary-content">${diary.content}</div>
                    
                    <div class="comments-section">
                        <h4 class="comments-title"><i class="fas fa-comments"></i> è¡¥å……è®°å½• (${comments.length})</h4>
                        <div class="comments-list">
                            ${commentsHtml}
                        </div>
                        
                        <div class="add-comment">
                            <button class="btn btn-secondary add-comment-btn" style="width:100%;">
                                <i class="fas fa-plus"></i> æ·»åŠ è¡¥å……è®°å½•
                            </button>
                            
                            <div class="comment-form hidden">
                                <textarea class="comment-textarea" placeholder="è¡¥å……ä»Šå¤©çš„æ–°æƒ³æ³•..." rows="3"></textarea>
                                <button class="btn btn-primary save-comment-btn" style="width:100%;">
                                    <i class="fas fa-paper-plane"></i> ä¿å­˜è¡¥å……
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== ç¼–è¾‘ä¸åˆ é™¤ ==========
        function editDiary(diaryId) {
            const diaries = loadDiaries();
            const diary = diaries.find(d => d.id === diaryId);
            
            if (!diary) {
                alert('æœªæ‰¾åˆ°æ—¥è®°');
                return;
            }
            
            // å¡«å……ç¼–è¾‘å™¨
            document.getElementById('dateInput').value = diary.date;
            document.getElementById('foodInput').value = diary.food || '';
            document.getElementById('diaryText').value = diary.content;
            
            // è®¾ç½®å¿ƒæƒ…
            currentEditorState.selectedMood = diary.mood;
            document.querySelectorAll('.mood-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.mood === diary.mood);
            });
            
            // è®¾ç½®å¤©æ°”
            currentEditorState.selectedWeather = diary.weather;
            document.querySelectorAll('.weather-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.weather === diary.weather);
            });
            
            // è®¾ç½®æ ‡ç­¾
            currentEditorState.selectedTags = diary.tags || [];
            document.querySelectorAll('.tag-option').forEach(opt => {
                opt.classList.toggle('selected', diary.tags.includes(opt.dataset.tag));
            });
            
            // æ ‡è®°ä¸ºç¼–è¾‘æ¨¡å¼
            currentEditorState.editingDiaryId = diaryId;
            
            // æ»šåŠ¨åˆ°ç¼–è¾‘å™¨
            document.querySelector('.editor-card').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteDiary(diaryId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿè¿™ä¹Ÿä¼šåˆ é™¤æ‰€æœ‰è¡¥å……è®°å½•ã€‚')) {
                return;
            }
            
            const diaries = loadDiaries();
            const diary = diaries.find(d => d.id === diaryId);
            
            if (!diary) return;
            
            // åˆ é™¤ä¸»æ—¥è®°
            const filteredDiaries = diaries.filter(d => d.id !== diaryId);
            saveDiaries(filteredDiaries);
            
            // åˆ é™¤ç›¸å…³è¯„è®º
            const comments = loadComments();
            if (comments[diary.date]) {
                delete comments[diary.date];
                saveComments(comments);
            }
            
            // å¦‚æœæ­£åœ¨ç¼–è¾‘è¿™ç¯‡æ—¥è®°ï¼Œæ¸…ç©ºç¼–è¾‘å™¨
            if (currentEditorState.editingDiaryId === diaryId) {
                resetEditor();
            }
            
            renderDiaryList();
            alert('æ—¥è®°å·²åˆ é™¤');
        }

        function saveComment(parentDate) {
            const commentText = document.querySelector(`[data-diary-id="${currentEditorState.editingDiaryId || 'new'}"] .comment-textarea`)?.value.trim();
            const food = document.getElementById('foodInput').value.trim();
            
            if (!commentText && currentEditorState.selectedTags.length === 0 && !food) {
                alert('è¯·è‡³å°‘å¡«å†™è¡¥å……å†…å®¹ã€é€‰æ‹©æ ‡ç­¾æˆ–å¡«å†™ç¾é£Ÿä¸­çš„ä¸€é¡¹');
                return;
            }
            
            const commentData = {
                id: `comment_${Date.now()}`,
                date: parentDate,
                mood: currentEditorState.selectedMood,
                weather: currentEditorState.selectedWeather,
                food: food,
                tags: [...currentEditorState.selectedTags],
                content: commentText || '',
                createdAt: new Date().toISOString(),
                isComment: true,
                parentDate: parentDate
            };
            
            const comments = loadComments();
            if (!comments[parentDate]) {
                comments[parentDate] = [];
            }
            comments[parentDate].push(commentData);
            saveComments(comments);
            
            // æ¸…ç©ºè¯„è®ºè¡¨å•
            document.querySelectorAll('.comment-textarea').forEach(ta => ta.value = '');
            document.querySelectorAll('.comment-form').forEach(form => form.classList.add('hidden'));
            
            renderDiaryList();
            alert('è¡¥å……è®°å½•å·²ä¿å­˜ï¼');
        }

        // ========== æ•°æ®å¯¼å…¥å¯¼å‡º ==========
        function exportMonthlyDiaries() {
            const monthValue = document.getElementById('exportMonth').value;
            if (!monthValue) {
                alert('è¯·å…ˆé€‰æ‹©æœˆä»½');
                return;
            }
            
            const [year, month] = monthValue.split('-');
            const diaries = loadDiaries().filter(d => !d.isComment);
            const allComments = loadComments();
            
            const monthDiaries = diaries.filter(diary => {
                const diaryDate = new Date(diary.date);
                return diaryDate.getFullYear() == year && (diaryDate.getMonth() + 1) == month;
            });
            
            if (monthDiaries.length === 0) {
                alert('è¯¥æœˆä»½æ²¡æœ‰æ—¥è®°è®°å½•');
                return;
            }
            
            let exportText = `ğŸ“… ${year}å¹´${month}æœˆ æ—¥è®°å¤‡ä»½\n`;
            exportText += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n`;
            exportText += `å…±è®¡ ${monthDiaries.length} ç¯‡æ—¥è®°\n`;
            exportText += "=".repeat(40) + "\n\n";
            
            monthDiaries.forEach((diary, index) => {
                const dateObj = new Date(diary.date);
                const formattedDate = dateObj.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
                
                exportText += `ã€æ—¥è®° ${index + 1}ã€‘\n`;
                exportText += `ğŸ“… æ—¥æœŸï¼š${formattedDate}\n`;
                exportText += `ğŸ˜Š å¿ƒæƒ…ï¼š${getMoodText(diary.mood)}\n`;
                exportText += `ğŸŒ¤ï¸ å¤©æ°”ï¼š${getWeatherText(diary.weather)}\n`;
                
                if (diary.food) {
                    exportText += `ğŸ½ï¸ é¥®é£Ÿï¼š${diary.food}\n`;
                }
                
                if (diary.tags.length > 0) {
                    exportText += `ğŸ·ï¸ æ ‡ç­¾ï¼š${diary.tags.join('ï¼Œ ')}\n`;
                }
                
                exportText += `\nğŸ“ æ­£æ–‡ï¼š\n${diary.content}\n`;
                
                // æ·»åŠ è¯„è®º/è¡¥å……è®°å½•
                const comments = allComments[diary.date] || [];
                if (comments.length > 0) {
                    exportText += `\nğŸ’¬ è¡¥å……è®°å½• (${comments.length}æ¡)ï¼š\n`;
                    comments.forEach((comment, idx) => {
                        exportText += `  ${idx + 1}. ${formatTime(comment.createdAt)} - ${comment.content || '(æ— æ­£æ–‡)'}`;
                        if (comment.food) exportText += ` | ğŸ½ï¸ ${comment.food}`;
                        if (comment.tags.length > 0) exportText += ` | ğŸ·ï¸ ${comment.tags.join(',')}`;
                        exportText += '\n';
                    });
                }
                
                exportText += "\n" + "-".repeat(30) + "\n\n";
            });
            
            exportText += `å¤‡ä»½æç¤ºï¼šæ­¤æ–‡æœ¬æ–‡ä»¶åŒ…å«${monthDiaries.length}ç¯‡æ—¥è®°åŠè¡¥å……è®°å½•ã€‚\nè¯·å¦¥å–„ä¿å­˜ï¼Œå¯ä½¿ç”¨ä¸‹æ–¹å¯¼å…¥åŠŸèƒ½æ¢å¤ã€‚`;
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(exportText).then(() => {
                document.getElementById('exportOutput').value = exportText;
                alert(`å·²ç”Ÿæˆ${monthDiaries.length}ç¯‡æ—¥è®°çš„å¤‡ä»½æ–‡æœ¬ï¼Œå¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nä½ å¯ä»¥ç›´æ¥ç²˜è´´åˆ°æ–‡æœ¬æ–‡ä»¶ä¸­ä¿å­˜ã€‚`);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                document.getElementById('exportOutput').value = exportText;
                alert(`å·²ç”Ÿæˆå¤‡ä»½æ–‡æœ¬ï¼Œä½†è‡ªåŠ¨å¤åˆ¶å¤±è´¥ã€‚è¯·æ‰‹åŠ¨å¤åˆ¶ä¸Šæ–¹æ–‡æœ¬æ¡†å†…å®¹ã€‚`);
            });
        }

        function importDiaries() {
            const importText = document.getElementById('importTextarea').value.trim();
            if (!importText) {
                alert('è¯·ç²˜è´´å¤‡ä»½æ–‡æœ¬');
                return;
            }
            
            if (!confirm('è¿™å°†è¦†ç›–ç°æœ‰æ—¥è®°ä¸­ç›¸åŒæ—¥æœŸçš„æ¡ç›®ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                return;
            }
            
            const importedData = parseBackupText(importText);
            if (importedData.diaries.length === 0) {
                alert('æœªèƒ½ä»æ–‡æœ¬ä¸­è§£æå‡ºæœ‰æ•ˆçš„æ—¥è®°ã€‚è¯·æ£€æŸ¥æ ¼å¼ã€‚');
                return;
            }
            
            // åˆå¹¶æ—¥è®°
            const existingDiaries = loadDiaries().filter(d => !d.isComment);
            const dateMap = new Map();
            existingDiaries.forEach(d => dateMap.set(d.date, d));
            
            importedData.diaries.forEach(newDiary => {
                dateMap.set(newDiary.date, newDiary);
            });
            
            const mergedDiaries = Array.from(dateMap.values());
            saveDiaries(mergedDiaries);
            
            // åˆå¹¶è¯„è®ºï¼ˆå¦‚æœæœ‰ï¼‰
            if (importedData.comments && Object.keys(importedData.comments).length > 0) {
                const existingComments = loadComments();
                Object.keys(importedData.comments).forEach(date => {
                    existingComments[date] = importedData.comments[date];
                });
                saveComments(existingComments);
            }
            
            alert(`æˆåŠŸå¯¼å…¥ ${importedData.diaries.length} ç¯‡æ—¥è®°ï¼`);
            document.getElementById('importTextarea').value = '';
            renderDiaryList();
        }

        // ========== å·¥å…·å‡½æ•° ==========
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        }

        function getMoodText(mood) {
            const moodMap = {
                happy: 'å¼€å¿ƒ', excited: 'å…´å¥‹', love: 'æœ‰çˆ±', peaceful: 'å¹³å’Œ',
                grateful: 'æ„Ÿæ©', sad: 'ä½è½', tired: 'ç–²æƒ«', angry: 'ç”Ÿæ°”',
                anxious: 'ç„¦è™‘', sick: 'ä¸é€‚'
            };
            return moodMap[mood] || mood;
        }

        function getWeatherText(weather) {
            const weatherMap = {
                sunny: 'æ™´å¤©', cloudy: 'å¤šäº‘', rainy: 'é›¨å¤©',
                snowy: 'é›ªå¤©', windy: 'åˆ®é£', stormy: 'é›·æš´'
            };
            return weatherMap[weather] || weather;
        }

        // ========== äº‹ä»¶ç›‘å¬å™¨ç»‘å®š ==========
        function bindAllEventListeners() {
            console.log('ç»‘å®šäº‹ä»¶ç›‘å¬å™¨...');
            
            // ç”¨æˆ·è®¾ç½®æ¨¡æ€æ¡†
            document.getElementById('userAvatar').addEventListener('click', () => {
                document.getElementById('userSettingsModal').style.display = 'flex';
            });
            
            document.getElementById('settingsToggle').addEventListener('click', () => {
                document.getElementById('userSettingsModal').style.display = 'flex';
            });
            
            document.getElementById('closeModalBtn').addEventListener('click', () => {
                document.getElementById('userSettingsModal').style.display = 'none';
            });
            
            document.getElementById('cancelSettingsBtn').addEventListener('click', () => {
                document.getElementById('userSettingsModal').style.display = 'none';
                applyUserSettings(); // æ¢å¤åŸè®¾ç½®
            });
            
            // å¤´åƒä¸Šä¼ 
            document.getElementById('changeAvatarBtn').addEventListener('click', () => {
                document.getElementById('avatarUpload').click();
            });
            
            document.getElementById('avatarUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        userSettings.avatar = e.target.result;
                        document.getElementById('avatarPreview').src = userSettings.avatar;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // ä¿å­˜ç”¨æˆ·è®¾ç½®
            document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                userSettings.name = document.getElementById('userNameInput').value.trim() || 'æˆ‘';
                saveUserSettings();
                applyUserSettings();
                document.getElementById('userSettingsModal').style.display = 'none';
                alert('è®¾ç½®å·²ä¿å­˜ï¼');
            });
            
            // å¿ƒæƒ…é€‰æ‹©
            document.querySelectorAll('.mood-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    currentEditorState.selectedMood = this.dataset.mood;
                });
            });
            
            // å¤©æ°”é€‰æ‹©
            document.querySelectorAll('.weather-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    document.querySelectorAll('.weather-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    currentEditorState.selectedWeather = this.dataset.weather;
                });
            });
            
            // æ ‡ç­¾é€‰æ‹© (å¤šé€‰)
            document.querySelectorAll('.tag-option').forEach(opt => {
                opt.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    const tag = this.dataset.tag;
                    
                    if (this.classList.contains('selected')) {
                        if (!currentEditorState.selectedTags.includes(tag)) {
                            currentEditorState.selectedTags.push(tag);
                        }
                    } else {
                        currentEditorState.selectedTags = currentEditorState.selectedTags.filter(t => t !== tag);
                    }
                });
            });
            
            // ä¸»é¢˜é€‰æ‹©
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    userSettings.theme = this.dataset.theme;
                    document.body.className = `theme-${userSettings.theme}`;
                    document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    saveUserSettings();
                });
            });
            
            // ç•Œé¢é£æ ¼é€‰æ‹©
            document.querySelectorAll('.interface-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    userSettings.interface = this.dataset.interface;
                    document.querySelectorAll('.interface-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // è¿™é‡Œå¯ä»¥æ ¹æ®ä¸åŒç•Œé¢é£æ ¼è°ƒæ•´æ›´å¤šæ ·å¼
                    if (userSettings.interface === 'social') {
                        document.body.classList.add('theme-social');
                    } else {
                        document.body.classList.remove('theme-social');
                    }
                    
                    saveUserSettings();
                    alert(`å·²åˆ‡æ¢ä¸º${this.textContent.trim()}æ¨¡å¼ï¼Œéƒ¨åˆ†æ ·å¼å·²è°ƒæ•´ã€‚`);
                });
            });
            
            // ä¿å­˜æ—¥è®°æŒ‰é’®
            document.getElementById('saveDiaryBtn').addEventListener('click', saveNewDiary);
            
            // æ¸…ç©ºæŒ‰é’®
            document.getElementById('clearBtn').addEventListener('click', () => {
                if (confirm('æ¸…ç©ºå½“å‰ç¼–è¾‘å†…å®¹ï¼Ÿ')) {
                    resetEditor();
                }
            });
            
            // å¯¼å‡ºæŒ‰é’® (ä¿®å¤ï¼šç¡®ä¿ç»‘å®šæ­£ç¡®)
            document.getElementById('exportBtn').addEventListener('click', exportMonthlyDiaries);
            
            // å¯¼å…¥æŒ‰é’®
            document.getElementById('importBtn').addEventListener('click', importDiaries);
            
            // è®¾ç½®é»˜è®¤é€‰ä¸­é¡¹
            document.querySelector('.mood-option[data-mood="peaceful"]').classList.add('selected');
            document.querySelector('.weather-option[data-weather="sunny"]').classList.add('selected');
            
            console.log('äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆã€‚');
        }

        // ========== åº”ç”¨å¯åŠ¨ ==========
        // ç¡®ä¿DOMå®Œå…¨åŠ è½½ååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>