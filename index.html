<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>è‹¹æœéª‘å£«ï¼šå¹³å°å¤§å†’é™©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; font-family: sans-serif; }
        body { background: linear-gradient(#1a237e, #0d47a1); overflow: hidden; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #gameContainer { 
            position: relative; 
            width: 100%; 
            max-width: 500px; 
            height: 70vh; 
            background: #87CEEB; 
            border: 4px solid #FF9800; 
            border-radius: 10px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #gameCanvas { display: block; width: 100%; height: 100%; }
        
        /* æ¸¸æˆHUD */
        #hud { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; color: white; font-size: 1.2em; text-shadow: 2px 2px 0 #000; z-index: 100; }
        
        /* è™šæ‹ŸæŒ‰é”® - æ”¹ä¸ºå›ºå®šä½ç½® */
        #controls { 
            position: absolute; 
            bottom: 20px; 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            padding: 0 20px; 
            pointer-events: none; 
            z-index: 50;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            pointer-events: auto;
        }
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 0 rgba(0,0,0,0.4);
            transition: all 0.05s;
            -webkit-tap-highlight-color: transparent;
        }
        .control-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.4); }
        #jumpBtn { background: linear-gradient(#4CAF50, #2E7D32); }
        #attackBtn { background: linear-gradient(#f44336, #c62828); }
        
        /* æ–¹å‘é”® */
        #dPad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5px;
            pointer-events: auto;
        }
        .dir-btn {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        .dir-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
        #upBtn { grid-column: 2; grid-row: 1; }
        #leftBtn { grid-column: 1; grid-row: 2; }
        #rightBtn { grid-column: 3; grid-row: 2; }
        #downBtn { grid-column: 2; grid-row: 3; }
        
        /* æ¸¸æˆç•Œé¢ */
        .screen { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 200; 
            text-align: center; 
            padding: 20px; 
            color: white;
        }
        .screen h2 { font-size: 2.5em; color: #FFD700; margin-bottom: 20px; }
        .screen p { font-size: 1.2em; margin-bottom: 30px; max-width: 80%; }
        .screen button {
            background: linear-gradient(#FF6B6B, #C2185B);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #8B0000;
        }
        .screen button:active { transform: translateY(6px); box-shadow: 0 2px 0 #8B0000; }
        #gameOverScreen, #victoryScreen { display: none; }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="hud">
            <div>â¤ï¸ <span id="health">100</span></div>
            <div>â­ <span id="score">0</span></div>
            <div>ğŸ <span id="distance">0m</span></div>
        </div>
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="startScreen" class="screen">
            <h2>è‹¹æœéª‘å£«</h2>
            <p>å›½ç‹è¢«å›šç¦åœ¨å…³å¡ç»ˆç‚¹ï¼<br>ç©¿è¶Šå¹³å°ï¼Œå‡»è´¥æ€ªç‰©ï¼ŒæŠµè¾¾ç»ˆç‚¹ï¼<br><br><strong>æ“ä½œï¼š</strong><br>æ–¹å‘é”®ç§»åŠ¨ï¼ŒAé”®è·³è·ƒï¼ŒBé”®æ”»å‡»</p>
            <button id="startBtn">å¼€å§‹å†’é™©</button>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="gameOverScreen" class="screen">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>ä½ å·²å è½æ·±æ¸Š...</p>
            <button id="retryBtn">é‡è¯•å…³å¡</button>
        </div>
        
        <!-- èƒœåˆ©ç•Œé¢ -->
        <div id="victoryScreen" class="screen">
            <h2>èƒœåˆ©ï¼</h2>
            <p>ä½ æˆåŠŸæŠµè¾¾ç»ˆç‚¹ï¼<br>å¾—åˆ†ï¼š<span id="finalScore">0</span></p>
            <button id="nextLevelBtn">ä¸‹ä¸€å…³</button>
        </div>
        
        <!-- è™šæ‹Ÿæ§åˆ¶ -->
        <div id="controls">
            <div id="dPad">
                <button id="upBtn" class="dir-btn">â¬†ï¸</button>
                <button id="leftBtn" class="dir-btn">â¬…ï¸</button>
                <button id="rightBtn" class="dir-btn">â¡ï¸</button>
                <button id="downBtn" class="dir-btn">â¬‡ï¸</button>
            </div>
            <div class="btn-group">
                <button id="attackBtn" class="control-btn">âš”ï¸</button>
                <button id="jumpBtn" class="control-btn">â¬†ï¸</button>
            </div>
        </div>
    </div>

    <script>
// ==================== æ¸¸æˆæ ¸å¿ƒé…ç½® ====================
const CONFIG = {
    GRAVITY: 0.5,
    PLAYER_SPEED: 5,
    JUMP_FORCE: -11,
    CAMERA_SMOOTH: 0.1,
    WORLD_WIDTH: 3000
};

// ==================== æ¸¸æˆçŠ¶æ€ ====================
const GameState = {
    player: {
        x: 100, y: 300,
        vx: 0, vy: 0,
        width: 40, height: 60,
        isOnGround: false,
        facingRight: true,
        health: 100,
        score: 0,
        // åŠ¨ä½œçŠ¶æ€
        isAttacking: false,
        attackTimer: 0,
        isJumping: false,
        // æ— æ•Œå¸§
        invincible: 0,
        blink: 0
    },
    camera: { x: 0, y: 0 },
    level: 1,
    keys: { left: false, right: false, up: false, attack: false },
    platforms: [],
    monsters: [],
    coins: [],
    goal: { x: 2800, y: 200, width: 60, height: 80 },
    gameActive: false,
    gameOver: false,
    victory: false
};

// ==================== åˆå§‹åŒ–å…³å¡ ====================
function initLevel(level) {
    // é‡ç½®ç©å®¶
    GameState.player = {
        x: 100, y: 300,
        vx: 0, vy: 0,
        width: 40, height: 60,
        isOnGround: false,
        facingRight: true,
        health: 100,
        score: 0,
        isAttacking: false,
        attackTimer: 0,
        isJumping: false,
        invincible: 0,
        blink: 0
    };
    
    GameState.platforms = [
        // åœ°é¢
        {x: 0, y: 450, width: 800, height: 50, color: '#8B4513'},
        // å¹³å°åºåˆ— - æ„æˆä¸€æ¡é€šå¾€ç»ˆç‚¹çš„è·¯å¾„
        {x: 300, y: 380, width: 100, height: 20, color: '#A0522D'},
        {x: 500, y: 330, width: 120, height: 20, color: '#A0522D'},
        {x: 700, y: 280, width: 100, height: 20, color: '#A0522D'},
        {x: 900, y: 230, width: 150, height: 20, color: '#A0522D'},
        {x: 1150, y: 180, width: 100, height: 20, color: '#A0522D'},
        {x: 1350, y: 250, width: 200, height: 20, color: '#A0522D'},
        {x: 1650, y: 200, width: 100, height: 20, color: '#A0522D'},
        {x: 1850, y: 150, width: 150, height: 20, color: '#A0522D'},
        {x: 2100, y: 220, width: 200, height: 20, color: '#A0522D'},
        {x: 2400, y: 180, width: 100, height: 20, color: '#A0522D'},
        {x: 2600, y: 130, width: 200, height: 20, color: '#A0522D'},
        // ç»ˆç‚¹å¹³å°
        {x: 2750, y: 100, width: 150, height: 30, color: '#FFD700'}
    ];
    
    // æ ¹æ®å…³å¡å¢åŠ éš¾åº¦
    const monsterCount = 3 + level;
    GameState.monsters = [];
    for (let i = 0; i < monsterCount; i++) {
        const platformIndex = Math.floor(Math.random() * (GameState.platforms.length - 5)) + 2;
        const plat = GameState.platforms[platformIndex];
        GameState.monsters.push({
            x: plat.x + 20,
            y: plat.y - 50,
            width: 40 + level * 5,
            height: 50 + level * 5,
            vx: (Math.random() > 0.5 ? 1 : -1) * (0.5 + level * 0.2),
            health: 20 + level * 10,
            type: ['strawberry', 'pineapple', 'grape'][i % 3],
            color: ['#FF6B6B', '#FFD700', '#9B5DE5'][i % 3]
        });
    }
    
    // é‡‘å¸
    GameState.coins = [];
    for (let i = 0; i < 20; i++) {
        const platIndex = Math.floor(Math.random() * (GameState.platforms.length - 2)) + 1;
        const plat = GameState.platforms[platIndex];
        GameState.coins.push({
            x: plat.x + Math.random() * (plat.width - 20),
            y: plat.y - 30,
            width: 15, height: 15,
            collected: false
        });
    }
    
    GameState.goal = { x: 2800, y: 200, width: 60, height: 80 };
    GameState.camera = { x: 0, y: 0 };
    GameState.gameActive = true;
    GameState.gameOver = false;
    GameState.victory = false;
}

// ==================== æ ¸å¿ƒæ¸¸æˆå¾ªç¯ ====================
function update() {
    const p = GameState.player;
    
    // 1. å¤„ç†è¾“å…¥
    p.vx = 0;
    if (GameState.keys.left) { p.vx = -CONFIG.PLAYER_SPEED; p.facingRight = false; }
    if (GameState.keys.right) { p.vx = CONFIG.PLAYER_SPEED; p.facingRight = true; }
    
    // è·³è·ƒï¼ˆæŒ‰ä¸‹æ—¶è§¦å‘ï¼Œå…è®¸å°è·³ï¼‰
    if (GameState.keys.up && p.isOnGround) {
        p.vy = CONFIG.JUMP_FORCE;
        p.isOnGround = false;
        p.isJumping = true;
    }
    // æ¾é”®æ—¶å–æ¶ˆè·³è·ƒï¼ˆå®ç°å°è·³ï¼‰
    if (!GameState.keys.up && p.vy < -5) {
        p.vy = -5;
    }
    
    // æ”»å‡»
    if (GameState.keys.attack && p.attackTimer <= 0) {
        p.isAttacking = true;
        p.attackTimer = 15;
    }
    
    // 2. åº”ç”¨ç‰©ç†
    p.vy += CONFIG.GRAVITY;
    p.x += p.vx;
    p.y += p.vy;
    
    // 3. å¹³å°ç¢°æ’
    p.isOnGround = false;
    for (const plat of GameState.platforms) {
        if (p.x < plat.x + plat.width &&
            p.x + p.width > plat.x &&
            p.y < plat.y + plat.height &&
            p.y + p.height > plat.y) {
            
            // è½åœ°
            if (p.vy > 0 && p.y + p.height - p.vy <= plat.y) {
                p.y = plat.y - p.height;
                p.vy = 0;
                p.isOnGround = true;
                p.isJumping = false;
            }
            // é¡¶å¤´
            else if (p.vy < 0) {
                p.y = plat.y + plat.height;
                p.vy = 0;
            }
            // ä¾§ç¢°
            else if (p.vx !== 0) {
                p.x = p.vx > 0 ? plat.x - p.width : plat.x + plat.width;
                p.vx = 0;
            }
        }
    }
    
    // 4. è¾¹ç•Œæ­»äº¡
    if (p.y > 600) {
        p.health = 0;
    }
    
    // 5. æ›´æ–°æ”»å‡»è®¡æ—¶å™¨
    if (p.attackTimer > 0) {
        p.attackTimer--;
        if (p.attackTimer <= 0) p.isAttacking = false;
    }
    
    // 6. æ— æ•Œå¸§
    if (p.invincible > 0) {
        p.invincible--;
        p.blink = (p.blink + 1) % 10;
    }
    
    // 7. æ”»å‡»æ£€æµ‹
    if (p.isAttacking) {
        const attackRange = p.facingRight ? 50 : -50;
        const attackX = p.facingRight ? p.x + p.width : p.x - 30;
        const attackY = p.y + 20;
        
        for (const m of GameState.monsters) {
            if (attackX < m.x + m.width &&
                attackX + 30 > m.x &&
                attackY < m.y + m.height &&
                attackY + 30 > m.y) {
                m.health -= 25;
                m.vx = p.facingRight ? 10 : -10; // å‡»é€€
                p.score += 50;
                if (m.health <= 0) p.score += 100;
            }
        }
    }
    
    // 8. æ›´æ–°æ€ªç‰©
    for (let i = GameState.monsters.length - 1; i >= 0; i--) {
        const m = GameState.monsters[i];
        
        // AIç§»åŠ¨
        m.x += m.vx;
        
        // ç®€å•å¹³å°è¾¹ç¼˜æ£€æµ‹
        let onPlatform = false;
        for (const plat of GameState.platforms) {
            if (m.x >= plat.x && m.x + m.width <= plat.x + plat.width &&
                m.y + m.height >= plat.y - 2 && m.y + m.height <= plat.y + 5) {
                onPlatform = true;
                break;
            }
        }
        
        if (!onPlatform || m.x <= 0 || m.x + m.width >= CONFIG.WORLD_WIDTH) {
            m.vx *= -1;
        }
        
        // æ€ªç‰©æ”»å‡»ç©å®¶
        if (p.invincible <= 0 &&
            p.x < m.x + m.width &&
            p.x + p.width > m.x &&
            p.y < m.y + m.height &&
            p.y + p.height > m.y) {
            p.health -= 10;
            p.invincible = 30;
            p.vx = m.x > p.x ? -8 : 8;
            p.vy = -5;
            updateHUD();
        }
        
        // ç§»é™¤æ­»äº¡çš„æ€ªç‰©
        if (m.health <= 0) {
            GameState.monsters.splice(i, 1);
        }
    }
    
    // 9. é‡‘å¸æ”¶é›†
    for (const coin of GameState.coins) {
        if (!coin.collected &&
            p.x < coin.x + coin.width &&
            p.x + p.width > coin.x &&
            p.y < coin.y + coin.height &&
            p.y + p.height > coin.y) {
            coin.collected = true;
            p.score += 10;
            updateHUD();
        }
    }
    
    // 10. æ£€æŸ¥èƒœåˆ©ï¼ˆåˆ°è¾¾ç»ˆç‚¹ï¼‰
    if (p.x < GameState.goal.x + GameState.goal.width &&
        p.x + p.width > GameState.goal.x &&
        p.y < GameState.goal.y + GameState.goal.height &&
        p.y + p.height > GameState.goal.y) {
        GameState.victory = true;
        GameState.gameActive = false;
        document.getElementById('finalScore').textContent = p.score;
        document.getElementById('victoryScreen').style.display = 'flex';
    }
    
    // 11. æ£€æŸ¥æ­»äº¡
    if (p.health <= 0) {
        GameState.gameOver = true;
        GameState.gameActive = false;
        document.getElementById('gameOverScreen').style.display = 'flex';
    }
    
    // 12. æ›´æ–°ç›¸æœº
    const targetX = p.x - canvas.width / 3;
    GameState.camera.x += (targetX - GameState.camera.x) * CONFIG.CAMERA_SMOOTH;
    GameState.camera.x = Math.max(0, Math.min(GameState.camera.x, CONFIG.WORLD_WIDTH - canvas.width));
    
    updateHUD();
}

// ==================== æ¸²æŸ“ ====================
function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-GameState.camera.x, -GameState.camera.y);
    
    // 1. ç»˜åˆ¶èƒŒæ™¯
    drawBackground();
    
    // 2. ç»˜åˆ¶å¹³å°
    for (const plat of GameState.platforms) {
        ctx.fillStyle = plat.color;
        ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
        // å¹³å°é¡¶éƒ¨é«˜å…‰
        ctx.fillStyle = plat.color === '#FFD700' ? '#FFF59D' : '#D2691E';
        ctx.fillRect(plat.x, plat.y, plat.width, 5);
    }
    
    // 3. ç»˜åˆ¶é‡‘å¸
    for (const coin of GameState.coins) {
        if (!coin.collected) {
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(coin.x + 7.5, coin.y + 7.5, 7.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFA000';
            ctx.beginPath();
            ctx.arc(coin.x + 7.5, coin.y + 7.5, 5, 0, Math.PI * 2);
            ctx.fill();
        }
    }
    
    // 4. ç»˜åˆ¶æ€ªç‰©
    for (const m of GameState.monsters) {
        ctx.fillStyle = m.color;
        // èº«ä½“
        ctx.beginPath();
        ctx.roundRect(m.x, m.y, m.width, m.height, 10);
        ctx.fill();
        // çœ¼ç›
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(m.x + m.width/3, m.y + m.height/3, 5, 0, Math.PI * 2);
        ctx.arc(m.x + 2*m.width/3, m.y + m.height/3, 5, 0, Math.PI * 2);
        ctx.fill();
        // ç³å­”
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(m.x + m.width/3 + (m.vx > 0 ? 2 : -2), m.y + m.height/3, 2, 0, Math.PI * 2);
        ctx.arc(m.x + 2*m.width/3 + (m.vx > 0 ? 2 : -2), m.y + m.height/3, 2, 0, Math.PI * 2);
        ctx.fill();
        // å˜´å·´
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(m.x + m.width/2, m.y + 2*m.height/3, 8, 0.2, 0.8 * Math.PI);
        ctx.stroke();
    }
    
    // 5. ç»˜åˆ¶ç©å®¶ï¼ˆè‹¹æœéª‘å£«ï¼‰
    drawPlayer();
    
    // 6. ç»˜åˆ¶ç»ˆç‚¹ï¼ˆå›½ç‹è‹¹æœï¼‰
    ctx.fillStyle = '#FF6B6B';
    ctx.beginPath();
    ctx.ellipse(GameState.goal.x + 30, GameState.goal.y + 40, 30, 40, 0, 0, Math.PI * 2);
    ctx.fill();
    // çš‡å† 
    ctx.fillStyle = '#FFD700';
    ctx.fillRect(GameState.goal.x + 15, GameState.goal.y, 30, 15);
    ctx.beginPath();
    ctx.moveTo(GameState.goal.x + 15, GameState.goal.y);
    ctx.lineTo(GameState.goal.x + 22, GameState.goal.y - 10);
    ctx.lineTo(GameState.goal.x + 30, GameState.goal.y);
    ctx.lineTo(GameState.goal.x + 38, GameState.goal.y - 10);
    ctx.lineTo(GameState.goal.x + 45, GameState.goal.y);
    ctx.fill();
    
    ctx.restore();
}

function drawPlayer() {
    const p = GameState.player;
    if (p.invincible > 0 && p.blink < 5) return; // æ— æ•Œé—ªçƒ
    
    ctx.save();
    ctx.translate(p.x + p.width/2, p.y + p.height/2);
    if (!p.facingRight) ctx.scale(-1, 1);
    
    // èº«ä½“ï¼ˆè‹¹æœï¼‰
    ctx.fillStyle = '#FF4444';
    ctx.beginPath();
    ctx.ellipse(0, 0, p.width/2 - 5, p.height/2 - 5, 0, 0, Math.PI * 2);
    ctx.fill();
    
    // èŒå’Œå¶
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(-2, -p.height/2 + 5, 4, 10);
    ctx.fillStyle = '#228B22';
    ctx.beginPath();
    ctx.ellipse(5, -p.height/2 + 10, 6, 4, Math.PI/4, 0, Math.PI * 2);
    ctx.fill();
    
    // çœ¼ç›
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(-8, -5, 5, 0, Math.PI * 2);
    ctx.arc(8, -5, 5, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.fillStyle = 'black';
    ctx.beginPath();
    ctx.arc(-8, -5, 2, 0, Math.PI * 2);
    ctx.arc(8, -5, 2, 0, Math.PI * 2);
    ctx.fill();
    
    // å˜´å·´ï¼ˆæ ¹æ®çŠ¶æ€å˜åŒ–ï¼‰
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 2;
    ctx.beginPath();
    if (p.isAttacking) {
        ctx.arc(0, 5, 6, 0.1 * Math.PI, 0.9 * Math.PI);
    } else {
        ctx.arc(0, 5, 6, 0.3 * Math.PI, 0.7 * Math.PI);
    }
    ctx.stroke();
    
    // å‰‘ï¼ˆæ”»å‡»æ—¶æ˜¾ç¤ºï¼‰
    if (p.isAttacking) {
        ctx.fillStyle = '#CCCCCC';
        ctx.fillRect(15, -10, 25, 4);
        ctx.fillRect(40, -15, 4, 15);
        // å‰‘å…‰
        ctx.fillStyle = 'rgba(255, 255, 200, 0.7)';
        ctx.fillRect(44, -15, 8, 15);
    }
    
    ctx.restore();
}

function drawBackground() {
    // å¤©ç©º
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(1, '#98FB98');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, CONFIG.WORLD_WIDTH, canvas.height);
    
    // è¿œå±±
    ctx.fillStyle = '#2E8B57';
    for (let i = 0; i < 8; i++) {
        const x = (i * 400) % CONFIG.WORLD_WIDTH;
        ctx.beginPath();
        ctx.moveTo(x, canvas.height - 100);
        ctx.bezierCurveTo(x + 100, canvas.height - 200, x + 200, canvas.height - 150, x + 300, canvas.height - 100);
        ctx.lineTo(x + 300, canvas.height);
        ctx.lineTo(x, canvas.height);
        ctx.closePath();
        ctx.fill();
    }
    
    // äº‘
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    for (let i = 0; i < 10; i++) {
        const x = (i * 350 + GameState.camera.x * 0.2) % CONFIG.WORLD_WIDTH;
        const y = 60 + Math.sin(i) * 30;
        ctx.beginPath();
        ctx.arc(x, y, 30, 0, Math.PI * 2);
        ctx.arc(x + 25, y - 10, 20, 0, Math.PI * 2);
        ctx.arc(x + 25, y + 10, 20, 0, Math.PI * 2);
        ctx.arc(x - 25, y, 20, 0, Math.PI * 2);
        ctx.fill();
    }
}

// ==================== UIæ›´æ–° ====================
function updateHUD() {
    const p = GameState.player;
    document.getElementById('health').textContent = p.health;
    document.getElementById('score').textContent = p.score;
    const dist = Math.floor((p.x - 100) / 10);
    document.getElementById('distance').textContent = dist + 'm';
}

// ==================== ä¸»å¾ªç¯ ====================
function gameLoop() {
    if (GameState.gameActive) {
        update();
        render();
    }
    requestAnimationFrame(gameLoop);
}

// ==================== åˆå§‹åŒ– ====================
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
    canvas.width = document.getElementById('gameContainer').clientWidth;
    canvas.height = document.getElementById('gameContainer').clientHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// äº‹ä»¶ç›‘å¬
document.getElementById('startBtn').addEventListener('click', () => {
    initLevel(GameState.level);
    document.getElementById('startScreen').style.display = 'none';
});
document.getElementById('retryBtn').addEventListener('click', () => {
    initLevel(GameState.level);
    document.getElementById('gameOverScreen').style.display = 'none';
});
document.getElementById('nextLevelBtn').addEventListener('click', () => {
    GameState.level++;
    initLevel(GameState.level);
    document.getElementById('victoryScreen').style.display = 'none';
});

// é”®ç›˜æ§åˆ¶ï¼ˆå¼€å‘ç”¨ï¼‰
document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') GameState.keys.left = true;
    if (e.key === 'ArrowRight') GameState.keys.right = true;
    if (e.key === 'ArrowUp' || e.key === ' ') GameState.keys.up = true;
    if (e.key === 'a' || e.key === 'A') GameState.keys.attack = true;
});
document.addEventListener('keyup', (e) => {
    if (e.key === 'ArrowLeft') GameState.keys.left = false;
    if (e.key === 'ArrowRight') GameState.keys.right = false;
    if (e.key === 'ArrowUp' || e.key === ' ') GameState.keys.up = false;
    if (e.key === 'a' || e.key === 'A') GameState.keys.attack = false;
});

// è™šæ‹ŸæŒ‰é’®æ§åˆ¶
document.getElementById('leftBtn').addEventListener('touchstart', () => GameState.keys.left = true);
document.getElementById('leftBtn').addEventListener('touchend', () => GameState.keys.left = false);
document.getElementById('rightBtn').addEventListener('touchstart', () => GameState.keys.right = true);
document.getElementById('rightBtn').addEventListener('touchend', () => GameState.keys.right = false);
document.getElementById('jumpBtn').addEventListener('touchstart', () => GameState.keys.up = true);
document.getElementById('jumpBtn').addEventListener('touchend', () => GameState.keys.up = false);
document.getElementById('attackBtn').addEventListener('touchstart', () => GameState.keys.attack = true);
document.getElementById('attackBtn').addEventListener('touchend', () => GameState.keys.attack = false);

// å¼€å§‹æ¸¸æˆå¾ªç¯
gameLoop();
    </script>
</body>
</html>